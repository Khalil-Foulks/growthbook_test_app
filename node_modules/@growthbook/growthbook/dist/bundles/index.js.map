{"version":3,"file":"index.js","sources":["../../src/feature-repository.ts","../../../../node_modules/dom-mutator/dist/dom-mutator.esm.js","../../src/util.ts","../../src/mongrule.ts","../../src/GrowthBook.ts"],"sourcesContent":["import {\n  ApiHost,\n  CacheSettings,\n  ClientKey,\n  FeatureApiResponse,\n  Polyfills,\n  RepositoryKey,\n} from \"./types/growthbook\";\nimport type { GrowthBook } from \".\";\n\ntype CacheEntry = {\n  data: FeatureApiResponse;\n  version: string;\n  staleAt: Date;\n};\ntype ScopedChannel = {\n  src: EventSource | null;\n  cb: (event: MessageEvent<string>) => void;\n  errors: number;\n};\n\n// Config settings\nconst cacheSettings: CacheSettings = {\n  // Consider a fetch stale after 1 minute\n  staleTTL: 1000 * 60,\n  cacheKey: \"gbFeaturesCache\",\n  backgroundSync: true,\n};\nconst polyfills: Polyfills = {\n  fetch: globalThis.fetch ? globalThis.fetch.bind(globalThis) : undefined,\n  SubtleCrypto: globalThis.crypto ? globalThis.crypto.subtle : undefined,\n  EventSource: globalThis.EventSource,\n};\ntry {\n  if (globalThis.localStorage) {\n    polyfills.localStorage = globalThis.localStorage;\n  }\n} catch (e) {\n  // Ignore localStorage errors\n}\n\n// Global state\nconst subscribedInstances: Map<RepositoryKey, Set<GrowthBook>> = new Map();\nlet cacheInitialized = false;\nconst cache: Map<RepositoryKey, CacheEntry> = new Map();\nconst activeFetches: Map<\n  RepositoryKey,\n  Promise<FeatureApiResponse>\n> = new Map();\nconst streams: Map<RepositoryKey, ScopedChannel> = new Map();\nconst supportsSSE: Set<RepositoryKey> = new Set();\n\n// Public functions\nexport function setPolyfills(overrides: Partial<Polyfills>): void {\n  Object.assign(polyfills, overrides);\n}\nexport function configureCache(overrides: Partial<CacheSettings>): void {\n  Object.assign(cacheSettings, overrides);\n  if (!cacheSettings.backgroundSync) {\n    clearAutoRefresh();\n  }\n}\n\nexport async function clearCache(): Promise<void> {\n  cache.clear();\n  activeFetches.clear();\n  clearAutoRefresh();\n  cacheInitialized = false;\n  await updatePersistentCache();\n}\n\nexport async function refreshFeatures(\n  instance: GrowthBook,\n  timeout?: number,\n  skipCache?: boolean,\n  allowStale?: boolean,\n  updateInstance?: boolean\n): Promise<void> {\n  const data = await fetchFeaturesWithCache(\n    instance,\n    allowStale,\n    timeout,\n    skipCache\n  );\n  updateInstance && data && (await refreshInstance(instance, data));\n}\n\n// Subscribe a GrowthBook instance to feature changes\nexport function subscribe(instance: GrowthBook): void {\n  const [key] = getKey(instance);\n  const subs = subscribedInstances.get(key) || new Set();\n  subs.add(instance);\n  subscribedInstances.set(key, subs);\n}\nexport function unsubscribe(instance: GrowthBook): void {\n  subscribedInstances.forEach((s) => s.delete(instance));\n}\n\n// Private functions\nasync function updatePersistentCache() {\n  try {\n    if (!polyfills.localStorage) return;\n    await polyfills.localStorage.setItem(\n      cacheSettings.cacheKey,\n      JSON.stringify(Array.from(cache.entries()))\n    );\n  } catch (e) {\n    // Ignore localStorage errors\n  }\n}\n\nasync function fetchFeaturesWithCache(\n  instance: GrowthBook,\n  allowStale?: boolean,\n  timeout?: number,\n  skipCache?: boolean\n): Promise<FeatureApiResponse | null> {\n  const [key] = getKey(instance);\n  const now = new Date();\n  await initializeCache();\n  const existing = cache.get(key);\n  if (existing && !skipCache && (allowStale || existing.staleAt > now)) {\n    // Reload features in the backgroud if stale\n    if (existing.staleAt < now) {\n      fetchFeatures(instance);\n    }\n    // Otherwise, if we don't need to refresh now, start a background sync\n    else {\n      startAutoRefresh(instance);\n    }\n    return existing.data;\n  } else {\n    const data = await promiseTimeout(fetchFeatures(instance), timeout);\n    return data;\n  }\n}\n\nfunction getKey(instance: GrowthBook): [RepositoryKey, ApiHost, ClientKey] {\n  const [apiHost, clientKey] = instance.getApiInfo();\n  return [`${apiHost}||${clientKey}`, apiHost, clientKey];\n}\n\n// Guarantee the promise always resolves within {timeout} ms\n// Resolved value will be `null` when there's an error or it takes too long\n// Note: The promise will continue running in the background, even if the timeout is hit\nfunction promiseTimeout<T>(\n  promise: Promise<T>,\n  timeout?: number\n): Promise<T | null> {\n  return new Promise((resolve) => {\n    let resolved = false;\n    let timer: unknown;\n    const finish = (data?: T) => {\n      if (resolved) return;\n      resolved = true;\n      timer && clearTimeout(timer as NodeJS.Timer);\n      resolve(data || null);\n    };\n\n    if (timeout) {\n      timer = setTimeout(() => finish(), timeout);\n    }\n\n    promise.then((data) => finish(data)).catch(() => finish());\n  });\n}\n\n// Populate cache from localStorage (if available)\nasync function initializeCache(): Promise<void> {\n  if (cacheInitialized) return;\n  cacheInitialized = true;\n  try {\n    if (polyfills.localStorage) {\n      const value = await polyfills.localStorage.getItem(\n        cacheSettings.cacheKey\n      );\n      if (value) {\n        const parsed: [RepositoryKey, CacheEntry][] = JSON.parse(value);\n        if (parsed && Array.isArray(parsed)) {\n          parsed.forEach(([key, data]) => {\n            cache.set(key, {\n              ...data,\n              staleAt: new Date(data.staleAt),\n            });\n          });\n        }\n      }\n    }\n  } catch (e) {\n    // Ignore localStorage errors\n  }\n}\n\n// Called whenever new features are fetched from the API\nfunction onNewFeatureData(key: RepositoryKey, data: FeatureApiResponse): void {\n  // If contents haven't changed, ignore the update, extend the stale TTL\n  const version = data.dateUpdated || \"\";\n  const staleAt = new Date(Date.now() + cacheSettings.staleTTL);\n  const existing = cache.get(key);\n  if (existing && version && existing.version === version) {\n    existing.staleAt = staleAt;\n    updatePersistentCache();\n    return;\n  }\n\n  // Update in-memory cache\n  cache.set(key, {\n    data,\n    version,\n    staleAt,\n  });\n  // Update local storage (don't await this, just update asynchronously)\n  updatePersistentCache();\n\n  // Update features for all subscribed GrowthBook instances\n  const instances = subscribedInstances.get(key);\n  instances && instances.forEach((instance) => refreshInstance(instance, data));\n}\n\nasync function refreshInstance(\n  instance: GrowthBook,\n  data: FeatureApiResponse\n): Promise<void> {\n  await (data.encryptedExperiments\n    ? instance.setEncryptedExperiments(\n        data.encryptedExperiments,\n        undefined,\n        polyfills.SubtleCrypto\n      )\n    : instance.setExperiments(data.experiments || instance.getExperiments()));\n\n  await (data.encryptedFeatures\n    ? instance.setEncryptedFeatures(\n        data.encryptedFeatures,\n        undefined,\n        polyfills.SubtleCrypto\n      )\n    : instance.setFeatures(data.features || instance.getFeatures()));\n}\n\nasync function fetchFeatures(\n  instance: GrowthBook\n): Promise<FeatureApiResponse> {\n  const [key, apiHost, clientKey] = getKey(instance);\n  const endpoint = apiHost + \"/api/features/\" + clientKey;\n\n  let promise = activeFetches.get(key);\n  if (!promise) {\n    promise = (polyfills.fetch as typeof globalThis.fetch)(endpoint)\n      // TODO: auto-retry if status code indicates a temporary error\n      .then((res) => {\n        if (res.headers.get(\"x-sse-support\") === \"enabled\") {\n          supportsSSE.add(key);\n        }\n        return res.json();\n      })\n      .then((data: FeatureApiResponse) => {\n        onNewFeatureData(key, data);\n        startAutoRefresh(instance);\n        activeFetches.delete(key);\n        return data;\n      })\n      .catch((e) => {\n        process.env.NODE_ENV !== \"production\" &&\n          instance.log(\"Error fetching features\", {\n            apiHost,\n            clientKey,\n            error: e ? e.message : null,\n          });\n        activeFetches.delete(key);\n        return Promise.resolve({});\n      });\n    activeFetches.set(key, promise);\n  }\n  return await promise;\n}\n\n// Watch a feature endpoint for changes\n// Will prefer SSE if enabled, otherwise fall back to cron\nfunction startAutoRefresh(instance: GrowthBook): void {\n  const [key, apiHost, clientKey] = getKey(instance);\n  if (\n    cacheSettings.backgroundSync &&\n    supportsSSE.has(key) &&\n    polyfills.EventSource\n  ) {\n    if (streams.has(key)) return;\n    const channel: ScopedChannel = {\n      src: null,\n      cb: (event: MessageEvent<string>) => {\n        try {\n          const json: FeatureApiResponse = JSON.parse(event.data);\n          onNewFeatureData(key, json);\n          // Reset error count on success\n          channel.errors = 0;\n        } catch (e) {\n          process.env.NODE_ENV !== \"production\" &&\n            instance.log(\"SSE Error\", {\n              apiHost,\n              clientKey,\n              error: e ? (e as Error).message : null,\n            });\n          onSSEError(channel, apiHost, clientKey);\n        }\n      },\n      errors: 0,\n    };\n    streams.set(key, channel);\n    enableChannel(channel, apiHost, clientKey);\n  }\n}\n\nfunction onSSEError(\n  channel: ScopedChannel,\n  apiHost: string,\n  clientKey: string\n) {\n  channel.errors++;\n  if (channel.errors > 3 || (channel.src && channel.src.readyState === 2)) {\n    // exponential backoff after 4 errors, with jitter\n    const delay =\n      Math.pow(3, channel.errors - 3) * (1000 + Math.random() * 1000);\n    disableChannel(channel);\n    setTimeout(() => {\n      enableChannel(channel, apiHost, clientKey);\n    }, Math.min(delay, 300000)); // 5 minutes max\n  }\n}\n\nfunction disableChannel(channel: ScopedChannel) {\n  if (!channel.src) return;\n  channel.src.onopen = null;\n  channel.src.onerror = null;\n  channel.src.close();\n  channel.src = null;\n}\n\nfunction enableChannel(\n  channel: ScopedChannel,\n  apiHost: string,\n  clientKey: string\n) {\n  channel.src = new polyfills.EventSource(\n    `${apiHost}/sub/${clientKey}`\n  ) as EventSource;\n  channel.src.addEventListener(\"features\", channel.cb);\n  channel.src.onerror = () => {\n    onSSEError(channel, apiHost, clientKey);\n  };\n  channel.src.onopen = () => {\n    channel.errors = 0;\n  };\n}\n\nfunction destroyChannel(channel: ScopedChannel, key: RepositoryKey) {\n  disableChannel(channel);\n  streams.delete(key);\n}\n\nfunction clearAutoRefresh() {\n  // Clear list of which keys are auto-updated\n  supportsSSE.clear();\n\n  // Stop listening for any SSE events\n  streams.forEach(destroyChannel);\n\n  // Remove all references to GrowthBook instances\n  subscribedInstances.clear();\n}\n","var validAttributeName = /^[a-zA-Z:_][a-zA-Z0-9:_.-]*$/;\nvar nullController = {\n  revert: function revert() {}\n};\nvar elements = /*#__PURE__*/new Map();\nvar mutations = /*#__PURE__*/new Set();\n\nfunction getObserverInit(attr) {\n  return attr === 'html' ? {\n    childList: true,\n    subtree: true,\n    attributes: true,\n    characterData: true\n  } : {\n    childList: false,\n    subtree: false,\n    attributes: true,\n    attributeFilter: [attr]\n  };\n}\n\nfunction getElementRecord(element) {\n  var record = elements.get(element);\n\n  if (!record) {\n    record = {\n      element: element,\n      attributes: {}\n    };\n    elements.set(element, record);\n  }\n\n  return record;\n}\n\nfunction createElementPropertyRecord(el, attr, getCurrentValue, setValue, mutationRunner) {\n  var currentValue = getCurrentValue(el);\n  var record = {\n    isDirty: false,\n    originalValue: currentValue,\n    virtualValue: currentValue,\n    mutations: [],\n    el: el,\n    observer: new MutationObserver(function () {\n      var currentValue = getCurrentValue(el);\n      if (currentValue === record.virtualValue) return;\n      record.originalValue = currentValue;\n      mutationRunner(record);\n    }),\n    mutationRunner: mutationRunner,\n    setValue: setValue,\n    getCurrentValue: getCurrentValue\n  };\n  record.observer.observe(el, getObserverInit(attr));\n  return record;\n}\n\nfunction queueIfNeeded(val, record) {\n  var currentVal = record.getCurrentValue(record.el);\n  record.virtualValue = val;\n\n  if (val && typeof val !== 'string') {\n    if (!currentVal || val.parentNode !== currentVal.parentNode || val.insertBeforeNode !== currentVal.insertBeforeNode) {\n      record.isDirty = true;\n      queueDOMUpdates();\n    }\n  } else if (val !== currentVal) {\n    record.isDirty = true;\n    queueDOMUpdates();\n  }\n}\n\nfunction htmlMutationRunner(record) {\n  var val = record.originalValue;\n  record.mutations.forEach(function (m) {\n    return val = m.mutate(val);\n  });\n  queueIfNeeded(getTransformedHTML(val), record);\n}\n\nfunction classMutationRunner(record) {\n  var val = new Set(record.originalValue.split(/\\s+/).filter(Boolean));\n  record.mutations.forEach(function (m) {\n    return m.mutate(val);\n  });\n  queueIfNeeded(Array.from(val).filter(Boolean).join(' '), record);\n}\n\nfunction attrMutationRunner(record) {\n  var val = record.originalValue;\n  record.mutations.forEach(function (m) {\n    return val = m.mutate(val);\n  });\n  queueIfNeeded(val, record);\n}\n\nfunction _loadDOMNodes(_ref) {\n  var parentSelector = _ref.parentSelector,\n      insertBeforeSelector = _ref.insertBeforeSelector;\n  var parentNode = document.querySelector(parentSelector);\n  if (!parentNode) return null;\n  var insertBeforeNode = insertBeforeSelector ? document.querySelector(insertBeforeSelector) : null;\n  if (insertBeforeSelector && !insertBeforeNode) return null;\n  return {\n    parentNode: parentNode,\n    insertBeforeNode: insertBeforeNode\n  };\n}\n\nfunction positionMutationRunner(record) {\n  var val = record.originalValue;\n  record.mutations.forEach(function (m) {\n    var selectors = m.mutate();\n\n    var newNodes = _loadDOMNodes(selectors);\n\n    val = newNodes || val;\n  });\n  queueIfNeeded(val, record);\n}\n\nvar getHTMLValue = function getHTMLValue(el) {\n  return el.innerHTML;\n};\n\nvar setHTMLValue = function setHTMLValue(el, value) {\n  return el.innerHTML = value;\n};\n\nfunction getElementHTMLRecord(element) {\n  var elementRecord = getElementRecord(element);\n\n  if (!elementRecord.html) {\n    elementRecord.html = createElementPropertyRecord(element, 'html', getHTMLValue, setHTMLValue, htmlMutationRunner);\n  }\n\n  return elementRecord.html;\n}\n\nvar getElementPosition = function getElementPosition(el) {\n  return {\n    parentNode: el.parentElement,\n    insertBeforeNode: el.nextElementSibling\n  };\n};\n\nvar setElementPosition = function setElementPosition(el, value) {\n  value.parentNode.insertBefore(el, value.insertBeforeNode);\n};\n\nfunction getElementPositionRecord(element) {\n  var elementRecord = getElementRecord(element);\n\n  if (!elementRecord.position) {\n    elementRecord.position = createElementPropertyRecord(element, 'position', getElementPosition, setElementPosition, positionMutationRunner);\n  }\n\n  return elementRecord.position;\n}\n\nvar setClassValue = function setClassValue(el, val) {\n  return val ? el.className = val : el.removeAttribute('class');\n};\n\nvar getClassValue = function getClassValue(el) {\n  return el.className;\n};\n\nfunction getElementClassRecord(el) {\n  var elementRecord = getElementRecord(el);\n\n  if (!elementRecord.classes) {\n    elementRecord.classes = createElementPropertyRecord(el, 'class', getClassValue, setClassValue, classMutationRunner);\n  }\n\n  return elementRecord.classes;\n}\n\nvar getAttrValue = function getAttrValue(attrName) {\n  return function (el) {\n    var _el$getAttribute;\n\n    return (_el$getAttribute = el.getAttribute(attrName)) != null ? _el$getAttribute : null;\n  };\n};\n\nvar setAttrValue = function setAttrValue(attrName) {\n  return function (el, val) {\n    return val !== null ? el.setAttribute(attrName, val) : el.removeAttribute(attrName);\n  };\n};\n\nfunction getElementAttributeRecord(el, attr) {\n  var elementRecord = getElementRecord(el);\n\n  if (!elementRecord.attributes[attr]) {\n    elementRecord.attributes[attr] = createElementPropertyRecord(el, attr, getAttrValue(attr), setAttrValue(attr), attrMutationRunner);\n  }\n\n  return elementRecord.attributes[attr];\n}\n\nfunction deleteElementPropertyRecord(el, attr) {\n  var element = elements.get(el);\n  if (!element) return;\n\n  if (attr === 'html') {\n    var _element$html, _element$html$observe;\n\n    (_element$html = element.html) == null ? void 0 : (_element$html$observe = _element$html.observer) == null ? void 0 : _element$html$observe.disconnect();\n    delete element.html;\n  } else if (attr === 'class') {\n    var _element$classes, _element$classes$obse;\n\n    (_element$classes = element.classes) == null ? void 0 : (_element$classes$obse = _element$classes.observer) == null ? void 0 : _element$classes$obse.disconnect();\n    delete element.classes;\n  } else if (attr === 'position') {\n    var _element$position, _element$position$obs;\n\n    (_element$position = element.position) == null ? void 0 : (_element$position$obs = _element$position.observer) == null ? void 0 : _element$position$obs.disconnect();\n    delete element.position;\n  } else {\n    var _element$attributes, _element$attributes$a, _element$attributes$a2;\n\n    (_element$attributes = element.attributes) == null ? void 0 : (_element$attributes$a = _element$attributes[attr]) == null ? void 0 : (_element$attributes$a2 = _element$attributes$a.observer) == null ? void 0 : _element$attributes$a2.disconnect();\n    delete element.attributes[attr];\n  }\n}\n\nvar transformContainer;\n\nfunction getTransformedHTML(html) {\n  if (!transformContainer) {\n    transformContainer = document.createElement('div');\n  }\n\n  transformContainer.innerHTML = html;\n  return transformContainer.innerHTML;\n}\n\nfunction setPropertyValue(el, attr, m) {\n  if (!m.isDirty) return;\n  m.isDirty = false;\n  var val = m.virtualValue;\n\n  if (!m.mutations.length) {\n    deleteElementPropertyRecord(el, attr);\n  }\n\n  m.setValue(el, val);\n}\n\nvar raf = false;\n\nfunction setValue(m, el) {\n  m.html && setPropertyValue(el, 'html', m.html);\n  m.classes && setPropertyValue(el, 'class', m.classes);\n  m.position && setPropertyValue(el, 'position', m.position);\n  Object.keys(m.attributes).forEach(function (attr) {\n    setPropertyValue(el, attr, m.attributes[attr]);\n  });\n}\n\nfunction setValues() {\n  raf = false;\n  elements.forEach(setValue);\n}\n\nfunction queueDOMUpdates() {\n  if (!raf) {\n    raf = true;\n    requestAnimationFrame(setValues);\n  }\n} // find or create ElementPropertyRecord, add mutation to it, then run\n\n\nfunction startMutating(mutation, element) {\n  var record = null;\n\n  if (mutation.kind === 'html') {\n    record = getElementHTMLRecord(element);\n  } else if (mutation.kind === 'class') {\n    record = getElementClassRecord(element);\n  } else if (mutation.kind === 'attribute') {\n    record = getElementAttributeRecord(element, mutation.attribute);\n  } else if (mutation.kind === 'position') {\n    record = getElementPositionRecord(element);\n  }\n\n  if (!record) return;\n  record.mutations.push(mutation);\n  record.mutationRunner(record);\n} // get (existing) ElementPropertyRecord, remove mutation from it, then run\n\n\nfunction stopMutating(mutation, el) {\n  var record = null;\n\n  if (mutation.kind === 'html') {\n    record = getElementHTMLRecord(el);\n  } else if (mutation.kind === 'class') {\n    record = getElementClassRecord(el);\n  } else if (mutation.kind === 'attribute') {\n    record = getElementAttributeRecord(el, mutation.attribute);\n  } else if (mutation.kind === 'position') {\n    record = getElementPositionRecord(el);\n  }\n\n  if (!record) return;\n  var index = record.mutations.indexOf(mutation);\n  if (index !== -1) record.mutations.splice(index, 1);\n  record.mutationRunner(record);\n} // maintain list of elements associated with mutation\n\n\nfunction refreshElementsSet(mutation) {\n  var existingElements = new Set(mutation.elements);\n  var newElements = new Set();\n  var matchingElements = document.querySelectorAll(mutation.selector);\n  matchingElements.forEach(function (el) {\n    newElements.add(el);\n\n    if (!existingElements.has(el)) {\n      mutation.elements.add(el);\n      startMutating(mutation, el);\n    }\n  });\n  existingElements.forEach(function (el) {\n    if (!newElements.has(el)) {\n      mutation.elements[\"delete\"](el);\n      stopMutating(mutation, el);\n    }\n  });\n}\n\nfunction revertMutation(mutation) {\n  mutation.elements.forEach(function (el) {\n    return stopMutating(mutation, el);\n  });\n  mutation.elements.clear();\n  mutations[\"delete\"](mutation);\n}\n\nfunction refreshAllElementSets() {\n  mutations.forEach(refreshElementsSet);\n} // Observer for elements that don't exist in the DOM yet\n\n\nvar observer;\nfunction disconnectGlobalObserver() {\n  observer && observer.disconnect();\n}\nfunction connectGlobalObserver() {\n  if (typeof document === 'undefined') return;\n\n  if (!observer) {\n    observer = new MutationObserver(function () {\n      refreshAllElementSets();\n    });\n  }\n\n  refreshAllElementSets();\n  observer.observe(document.documentElement, {\n    childList: true,\n    subtree: true,\n    attributes: false,\n    characterData: false\n  });\n} // run on init\n\nconnectGlobalObserver();\n\nfunction newMutation(m) {\n  // Not in a browser\n  if (typeof document === 'undefined') return nullController; // add to global index of mutations\n\n  mutations.add(m); // run refresh on init to establish list of elements associated w/ mutation\n\n  refreshElementsSet(m);\n  return {\n    revert: function revert() {\n      revertMutation(m);\n    }\n  };\n}\n\nfunction html(selector, mutate) {\n  return newMutation({\n    kind: 'html',\n    elements: new Set(),\n    mutate: mutate,\n    selector: selector\n  });\n}\n\nfunction position(selector, mutate) {\n  return newMutation({\n    kind: 'position',\n    elements: new Set(),\n    mutate: mutate,\n    selector: selector\n  });\n}\n\nfunction classes(selector, mutate) {\n  return newMutation({\n    kind: 'class',\n    elements: new Set(),\n    mutate: mutate,\n    selector: selector\n  });\n}\n\nfunction attribute(selector, attribute, mutate) {\n  if (!validAttributeName.test(attribute)) return nullController;\n\n  if (attribute === 'class' || attribute === 'className') {\n    return classes(selector, function (classnames) {\n      var mutatedClassnames = mutate(Array.from(classnames).join(' '));\n      classnames.clear();\n      if (!mutatedClassnames) return;\n      mutatedClassnames.split(/\\s+/g).filter(Boolean).forEach(function (c) {\n        return classnames.add(c);\n      });\n    });\n  }\n\n  return newMutation({\n    kind: 'attribute',\n    attribute: attribute,\n    elements: new Set(),\n    mutate: mutate,\n    selector: selector\n  });\n}\n\nfunction declarative(_ref2) {\n  var selector = _ref2.selector,\n      action = _ref2.action,\n      value = _ref2.value,\n      attr = _ref2.attribute,\n      parentSelector = _ref2.parentSelector,\n      insertBeforeSelector = _ref2.insertBeforeSelector;\n\n  if (attr === 'html') {\n    if (action === 'append') {\n      return html(selector, function (val) {\n        return val + (value != null ? value : '');\n      });\n    } else if (action === 'set') {\n      return html(selector, function () {\n        return value != null ? value : '';\n      });\n    }\n  } else if (attr === 'class') {\n    if (action === 'append') {\n      return classes(selector, function (val) {\n        if (value) val.add(value);\n      });\n    } else if (action === 'remove') {\n      return classes(selector, function (val) {\n        if (value) val[\"delete\"](value);\n      });\n    } else if (action === 'set') {\n      return classes(selector, function (val) {\n        val.clear();\n        if (value) val.add(value);\n      });\n    }\n  } else if (attr === 'position') {\n    if (action === 'set' && parentSelector) {\n      return position(selector, function () {\n        return {\n          insertBeforeSelector: insertBeforeSelector,\n          parentSelector: parentSelector\n        };\n      });\n    }\n  } else {\n    if (action === 'append') {\n      return attribute(selector, attr, function (val) {\n        return val !== null ? val + (value != null ? value : '') : value != null ? value : '';\n      });\n    } else if (action === 'set') {\n      return attribute(selector, attr, function () {\n        return value != null ? value : '';\n      });\n    } else if (action === 'remove') {\n      return attribute(selector, attr, function () {\n        return null;\n      });\n    }\n  }\n\n  return nullController;\n}\n\nvar index = {\n  html: html,\n  classes: classes,\n  attribute: attribute,\n  position: position,\n  declarative: declarative\n};\n\nexport default index;\nexport { connectGlobalObserver, disconnectGlobalObserver, validAttributeName };\n//# sourceMappingURL=dom-mutator.esm.js.map\n","import { UrlTarget, UrlTargetType, VariationRange } from \"./types/growthbook\";\n\nfunction hashFnv32a(str: string): number {\n  let hval = 0x811c9dc5;\n  const l = str.length;\n\n  for (let i = 0; i < l; i++) {\n    hval ^= str.charCodeAt(i);\n    hval +=\n      (hval << 1) + (hval << 4) + (hval << 7) + (hval << 8) + (hval << 24);\n  }\n  return hval >>> 0;\n}\n\nexport function hash(\n  seed: string,\n  value: string,\n  version: number\n): number | null {\n  // New unbiased hashing algorithm\n  if (version === 2) {\n    return (hashFnv32a(hashFnv32a(seed + value) + \"\") % 10000) / 10000;\n  }\n  // Original biased hashing algorithm (keep for backwards compatibility)\n  if (version === 1) {\n    return (hashFnv32a(value + seed) % 1000) / 1000;\n  }\n\n  // Unknown hash version\n  return null;\n}\n\nexport function getEqualWeights(n: number): number[] {\n  if (n <= 0) return [];\n  return new Array(n).fill(1 / n);\n}\n\nexport function inRange(n: number, range: VariationRange): boolean {\n  return n >= range[0] && n < range[1];\n}\n\nexport function inNamespace(\n  hashValue: string,\n  namespace: [string, number, number]\n): boolean {\n  const n = hash(\"__\" + namespace[0], hashValue, 1);\n  if (n === null) return false;\n  return n >= namespace[1] && n < namespace[2];\n}\n\nexport function chooseVariation(n: number, ranges: VariationRange[]): number {\n  for (let i = 0; i < ranges.length; i++) {\n    if (inRange(n, ranges[i])) {\n      return i;\n    }\n  }\n  return -1;\n}\n\nexport function getUrlRegExp(regexString: string): RegExp | undefined {\n  try {\n    const escaped = regexString.replace(/([^\\\\])\\//g, \"$1\\\\/\");\n    return new RegExp(escaped);\n  } catch (e) {\n    console.error(e);\n    return undefined;\n  }\n}\n\nexport function isURLTargeted(url: string, targets: UrlTarget[]) {\n  if (!targets.length) return false;\n  let hasIncludeRules = false;\n  let isIncluded = false;\n\n  for (let i = 0; i < targets.length; i++) {\n    const match = _evalURLTarget(url, targets[i].type, targets[i].pattern);\n    if (targets[i].include === false) {\n      if (match) return false;\n    } else {\n      hasIncludeRules = true;\n      if (match) isIncluded = true;\n    }\n  }\n\n  return isIncluded || !hasIncludeRules;\n}\n\nfunction _evalSimpleUrlPart(\n  actual: string,\n  pattern: string,\n  isPath: boolean\n): boolean {\n  try {\n    // Escape special regex characters and change wildcard `_____` to `.*`\n    let escaped = pattern\n      .replace(/[*.+?^${}()|[\\]\\\\]/g, \"\\\\$&\")\n      .replace(/_____/g, \".*\");\n\n    if (isPath) {\n      // When matching pathname, make leading/trailing slashes optional\n      escaped = \"\\\\/?\" + escaped.replace(/(^\\/|\\/$)/g, \"\") + \"\\\\/?\";\n    }\n\n    const regex = new RegExp(\"^\" + escaped + \"$\", \"i\");\n    return regex.test(actual);\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _evalSimpleUrlTarget(actual: URL, pattern: string) {\n  try {\n    // If a protocol is missing, but a host is specified, add `https://` to the front\n    // Use \"_____\" as the wildcard since `*` is not a valid hostname in some browsers\n    const expected = new URL(\n      pattern.replace(/^([^:/?]*)\\./i, \"https://$1.\").replace(/\\*/g, \"_____\"),\n      \"https://_____\"\n    );\n\n    // Compare each part of the URL separately\n    const comps: Array<[string, string, boolean]> = [\n      [actual.host, expected.host, false],\n      [actual.pathname, expected.pathname, true],\n    ];\n    // We only want to compare hashes if it's explicitly being targeted\n    if (expected.hash) {\n      comps.push([actual.hash, expected.hash, false]);\n    }\n\n    expected.searchParams.forEach((v, k) => {\n      comps.push([actual.searchParams.get(k) || \"\", v, false]);\n    });\n\n    // If any comparisons fail, the whole thing fails\n    return !comps.some(\n      (data) => !_evalSimpleUrlPart(data[0], data[1], data[2])\n    );\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _evalURLTarget(\n  url: string,\n  type: UrlTargetType,\n  pattern: string\n): boolean {\n  try {\n    const parsed = new URL(url, \"https://_\");\n\n    if (type === \"regex\") {\n      const regex = getUrlRegExp(pattern);\n      if (!regex) return false;\n      return (\n        regex.test(parsed.href) ||\n        regex.test(parsed.href.substring(parsed.origin.length))\n      );\n    } else if (type === \"simple\") {\n      return _evalSimpleUrlTarget(parsed, pattern);\n    }\n\n    return false;\n  } catch (e) {\n    return false;\n  }\n}\n\nexport function getBucketRanges(\n  numVariations: number,\n  coverage: number | undefined,\n  weights?: number[]\n): VariationRange[] {\n  coverage = coverage === undefined ? 1 : coverage;\n\n  // Make sure coverage is within bounds\n  if (coverage < 0) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\"Experiment.coverage must be greater than or equal to 0\");\n    }\n    coverage = 0;\n  } else if (coverage > 1) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\"Experiment.coverage must be less than or equal to 1\");\n    }\n    coverage = 1;\n  }\n\n  // Default to equal weights if missing or invalid\n  const equal = getEqualWeights(numVariations);\n  weights = weights || equal;\n  if (weights.length !== numVariations) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\n        \"Experiment.weights array must be the same length as Experiment.variations\"\n      );\n    }\n    weights = equal;\n  }\n\n  // If weights don't add up to 1 (or close to it), default to equal weights\n  const totalWeight = weights.reduce((w, sum) => sum + w, 0);\n  if (totalWeight < 0.99 || totalWeight > 1.01) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\"Experiment.weights must add up to 1\");\n    }\n    weights = equal;\n  }\n\n  // Covert weights to ranges\n  let cumulative = 0;\n  return weights.map((w) => {\n    const start = cumulative;\n    cumulative += w;\n    return [start, start + (coverage as number) * w];\n  }) as VariationRange[];\n}\n\nexport function getQueryStringOverride(\n  id: string,\n  url: string,\n  numVariations: number\n) {\n  if (!url) {\n    return null;\n  }\n\n  const search = url.split(\"?\")[1];\n  if (!search) {\n    return null;\n  }\n\n  const match = search\n    .replace(/#.*/, \"\") // Get rid of anchor\n    .split(\"&\") // Split into key/value pairs\n    .map((kv) => kv.split(\"=\", 2))\n    .filter(([k]) => k === id) // Look for key that matches the experiment id\n    .map(([, v]) => parseInt(v)); // Parse the value into an integer\n\n  if (match.length > 0 && match[0] >= 0 && match[0] < numVariations)\n    return match[0];\n\n  return null;\n}\n\nexport function isIncluded(include: () => boolean) {\n  try {\n    return include();\n  } catch (e) {\n    console.error(e);\n    return false;\n  }\n}\n\nconst base64ToBuf = (b: string) =>\n  Uint8Array.from(atob(b), (c) => c.charCodeAt(0));\n\nexport async function decrypt(\n  encryptedString: string,\n  decryptionKey?: string,\n  subtle?: SubtleCrypto\n): Promise<string> {\n  decryptionKey = decryptionKey || \"\";\n  subtle = subtle || (globalThis.crypto && globalThis.crypto.subtle);\n  if (!subtle) {\n    throw new Error(\"No SubtleCrypto implementation found\");\n  }\n  try {\n    const key = await subtle.importKey(\n      \"raw\",\n      base64ToBuf(decryptionKey),\n      { name: \"AES-CBC\", length: 128 },\n      true,\n      [\"encrypt\", \"decrypt\"]\n    );\n    const [iv, cipherText] = encryptedString.split(\".\");\n    const plainTextBuffer = await subtle.decrypt(\n      { name: \"AES-CBC\", iv: base64ToBuf(iv) },\n      key,\n      base64ToBuf(cipherText)\n    );\n\n    return new TextDecoder().decode(plainTextBuffer);\n  } catch (e) {\n    throw new Error(\"Failed to decrypt\");\n  }\n}\n\nexport function paddedVersionString(input: string): string {\n  // Remove build info and leading `v` if any\n  // Split version into parts (both core version numbers and pre-release tags)\n  // \"v1.2.3-rc.1+build123\" -> [\"1\",\"2\",\"3\",\"rc\",\"1\"]\n  const parts = input.replace(/(^v|\\+.*$)/g, \"\").split(/[-.]/);\n\n  // If it's SemVer without a pre-release, add `~` to the end\n  // [\"1\",\"0\",\"0\"] -> [\"1\",\"0\",\"0\",\"~\"]\n  // \"~\" is the largest ASCII character, so this will make \"1.0.0\" greater than \"1.0.0-beta\" for example\n  if (parts.length === 3) {\n    parts.push(\"~\");\n  }\n\n  // Left pad each numeric part with spaces so string comparisons will work (\"9\">\"10\", but \" 9\"<\"10\")\n  // Then, join back together into a single string\n  return parts\n    .map((v) => (v.match(/^[0-9]+$/) ? v.padStart(5, \" \") : v))\n    .join(\"-\");\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\n\nimport {\n  ConditionInterface,\n  TestedObj,\n  ConditionValue,\n  Operator,\n  OperatorConditionValue,\n  VarType,\n} from \"./types/mongrule\";\nimport { paddedVersionString } from \"./util\";\n\nconst _regexCache: { [key: string]: RegExp } = {};\n\n// The top-level condition evaluation function\nexport function evalCondition(\n  obj: TestedObj,\n  condition: ConditionInterface\n): boolean {\n  // Recursive condition\n  if (\"$or\" in condition) {\n    return evalOr(obj, condition[\"$or\"] as ConditionInterface[]);\n  }\n  if (\"$nor\" in condition) {\n    return !evalOr(obj, condition[\"$nor\"] as ConditionInterface[]);\n  }\n  if (\"$and\" in condition) {\n    return evalAnd(obj, condition[\"$and\"] as ConditionInterface[]);\n  }\n  if (\"$not\" in condition) {\n    return !evalCondition(obj, condition[\"$not\"] as ConditionInterface);\n  }\n\n  // Condition is an object, keys are object paths, values are the condition for that path\n  for (const [k, v] of Object.entries(condition)) {\n    if (!evalConditionValue(v, getPath(obj, k))) return false;\n  }\n  return true;\n}\n\n// Return value at dot-separated path of an object\nfunction getPath(obj: TestedObj, path: string) {\n  const parts = path.split(\".\");\n  let current: any = obj;\n  for (let i = 0; i < parts.length; i++) {\n    if (current && typeof current === \"object\" && parts[i] in current) {\n      current = current[parts[i]];\n    } else {\n      return null;\n    }\n  }\n  return current;\n}\n\n// Transform a regex string into a real RegExp object\nfunction getRegex(regex: string): RegExp {\n  if (!_regexCache[regex]) {\n    _regexCache[regex] = new RegExp(regex.replace(/([^\\\\])\\//g, \"$1\\\\/\"));\n  }\n  return _regexCache[regex];\n}\n\n// Evaluate a single value against a condition\nfunction evalConditionValue(condition: ConditionValue, value: any) {\n  // Simple equality comparisons\n  if (typeof condition === \"string\") {\n    return value + \"\" === condition;\n  }\n  if (typeof condition === \"number\") {\n    return value * 1 === condition;\n  }\n  if (typeof condition === \"boolean\") {\n    return !!value === condition;\n  }\n\n  if (condition === null) {\n    return value === null;\n  }\n\n  if (Array.isArray(condition) || !isOperatorObject(condition)) {\n    return JSON.stringify(value) === JSON.stringify(condition);\n  }\n\n  // This is a special operator condition and we should evaluate each one separately\n  for (const op in condition) {\n    if (\n      !evalOperatorCondition(\n        op as Operator,\n        value,\n        condition[op as keyof OperatorConditionValue]\n      )\n    ) {\n      return false;\n    }\n  }\n  return true;\n}\n\n// If the object has only keys that start with '$'\nfunction isOperatorObject(obj: any): boolean {\n  const keys = Object.keys(obj);\n  return (\n    keys.length > 0 && keys.filter((k) => k[0] === \"$\").length === keys.length\n  );\n}\n\n// Return the data type of a value\nfunction getType(v: any): VarType | \"unknown\" {\n  if (v === null) return \"null\";\n  if (Array.isArray(v)) return \"array\";\n  const t = typeof v;\n  if ([\"string\", \"number\", \"boolean\", \"object\", \"undefined\"].includes(t)) {\n    return t as VarType;\n  }\n  return \"unknown\";\n}\n\n// At least one element of actual must match the expected condition/value\nfunction elemMatch(actual: any, expected: any) {\n  if (!Array.isArray(actual)) return false;\n  const check = isOperatorObject(expected)\n    ? (v: any) => evalConditionValue(expected, v)\n    : (v: any) => evalCondition(v, expected);\n  for (let i = 0; i < actual.length; i++) {\n    if (actual[i] && check(actual[i])) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction isIn(actual: any, expected: Array<any>): boolean {\n  // Do an intersection is attribute is an array\n  if (Array.isArray(actual)) {\n    return actual.some((el) => expected.includes(el));\n  }\n  return expected.includes(actual);\n}\n\n// Evaluate a single operator condition\nfunction evalOperatorCondition(\n  operator: Operator,\n  actual: any,\n  expected: any\n): boolean {\n  switch (operator) {\n    case \"$veq\":\n      return paddedVersionString(actual) === paddedVersionString(expected);\n    case \"$vne\":\n      return paddedVersionString(actual) !== paddedVersionString(expected);\n    case \"$vgt\":\n      return paddedVersionString(actual) > paddedVersionString(expected);\n    case \"$vgte\":\n      return paddedVersionString(actual) >= paddedVersionString(expected);\n    case \"$vlt\":\n      return paddedVersionString(actual) < paddedVersionString(expected);\n    case \"$vlte\":\n      return paddedVersionString(actual) <= paddedVersionString(expected);\n    case \"$eq\":\n      return actual === expected;\n    case \"$ne\":\n      return actual !== expected;\n    case \"$lt\":\n      return actual < expected;\n    case \"$lte\":\n      return actual <= expected;\n    case \"$gt\":\n      return actual > expected;\n    case \"$gte\":\n      return actual >= expected;\n    case \"$exists\":\n      return expected ? actual !== null : actual === null;\n    case \"$in\":\n      if (!Array.isArray(expected)) return false;\n      return isIn(actual, expected);\n    case \"$nin\":\n      if (!Array.isArray(expected)) return false;\n      return !isIn(actual, expected);\n    case \"$not\":\n      return !evalConditionValue(expected, actual);\n    case \"$size\":\n      if (!Array.isArray(actual)) return false;\n      return evalConditionValue(expected, actual.length);\n    case \"$elemMatch\":\n      return elemMatch(actual, expected);\n    case \"$all\":\n      if (!Array.isArray(actual)) return false;\n      for (let i = 0; i < expected.length; i++) {\n        let passed = false;\n        for (let j = 0; j < actual.length; j++) {\n          if (evalConditionValue(expected[i], actual[j])) {\n            passed = true;\n            break;\n          }\n        }\n        if (!passed) return false;\n      }\n      return true;\n    case \"$regex\":\n      try {\n        return getRegex(expected).test(actual);\n      } catch (e) {\n        return false;\n      }\n    case \"$type\":\n      return getType(actual) === expected;\n    default:\n      console.error(\"Unknown operator: \" + operator);\n      return false;\n  }\n}\n\n// Recursive $or rule\nfunction evalOr(obj: TestedObj, conditions: ConditionInterface[]): boolean {\n  if (!conditions.length) return true;\n  for (let i = 0; i < conditions.length; i++) {\n    if (evalCondition(obj, conditions[i])) {\n      return true;\n    }\n  }\n  return false;\n}\n\n// Recursive $and rule\nfunction evalAnd(obj: TestedObj, conditions: ConditionInterface[]): boolean {\n  for (let i = 0; i < conditions.length; i++) {\n    if (!evalCondition(obj, conditions[i])) {\n      return false;\n    }\n  }\n  return true;\n}\n","import mutate, { DeclarativeMutation } from \"dom-mutator\";\nimport type {\n  Context,\n  Experiment,\n  FeatureResult,\n  Result,\n  SubscriptionFunction,\n  FeatureDefinition,\n  FeatureResultSource,\n  Attributes,\n  WidenPrimitives,\n  RealtimeUsageData,\n  LoadFeaturesOptions,\n  RefreshFeaturesOptions,\n  ApiHost,\n  ClientKey,\n  VariationMeta,\n  Filter,\n  VariationRange,\n  AutoExperimentVariation,\n  AutoExperiment,\n} from \"./types/growthbook\";\nimport type { ConditionInterface } from \"./types/mongrule\";\nimport {\n  getUrlRegExp,\n  isIncluded,\n  getBucketRanges,\n  hash,\n  chooseVariation,\n  getQueryStringOverride,\n  inNamespace,\n  inRange,\n  isURLTargeted,\n  decrypt,\n} from \"./util\";\nimport { evalCondition } from \"./mongrule\";\nimport { refreshFeatures, subscribe, unsubscribe } from \"./feature-repository\";\n\nconst isBrowser =\n  typeof window !== \"undefined\" && typeof document !== \"undefined\";\n\nexport class GrowthBook<\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  AppFeatures extends Record<string, any> = Record<string, any>\n> {\n  // context is technically private, but some tools depend on it so we can't mangle the name\n  // _ctx below is a clone of this property that we use internally\n  private context: Context;\n  public debug: boolean;\n  public ready: boolean;\n\n  // Properties and methods that start with \"_\" are mangled by Terser (saves ~150 bytes)\n  private _ctx: Context;\n  private _renderer: null | (() => void);\n  private _trackedExperiments: Set<unknown>;\n  private _trackedFeatures: Record<string, string>;\n  private _subscriptions: Set<SubscriptionFunction>;\n  private _rtQueue: RealtimeUsageData[];\n  private _rtTimer: number;\n  private _assigned: Map<\n    string,\n    {\n      // eslint-disable-next-line\n      experiment: Experiment<any>;\n      // eslint-disable-next-line\n      result: Result<any>;\n    }\n  >;\n  // eslint-disable-next-line\n  private _forcedFeatureValues: Map<string, any>;\n  private _attributeOverrides: Attributes;\n  private _activeAutoExperiments: Map<\n    string,\n    { valueHash: string; undo: () => void }\n  >;\n\n  constructor(context?: Context) {\n    context = context || {};\n    // These properties are all initialized in the constructor instead of above\n    // This saves ~80 bytes in the final output\n    this._ctx = this.context = context;\n    this._renderer = null;\n    this._trackedExperiments = new Set();\n    this._trackedFeatures = {};\n    this.debug = false;\n    this._subscriptions = new Set();\n    this._rtQueue = [];\n    this._rtTimer = 0;\n    this.ready = false;\n    this._assigned = new Map();\n    this._forcedFeatureValues = new Map();\n    this._attributeOverrides = {};\n    this._activeAutoExperiments = new Map();\n\n    if (context.features) {\n      this.ready = true;\n    }\n\n    if (isBrowser && context.enableDevMode) {\n      window._growthbook = this;\n      document.dispatchEvent(new Event(\"gbloaded\"));\n    }\n\n    if (context.experiments) {\n      this.ready = true;\n      this._updateAllAutoExperiments();\n    }\n\n    if (context.clientKey) {\n      this._refresh({}, true, false);\n    }\n  }\n\n  public async loadFeatures(options?: LoadFeaturesOptions): Promise<void> {\n    await this._refresh(options, true, true);\n    if (options && options.autoRefresh) {\n      subscribe(this);\n    }\n  }\n\n  public async refreshFeatures(\n    options?: RefreshFeaturesOptions\n  ): Promise<void> {\n    await this._refresh(options, false, true);\n  }\n\n  public getApiInfo(): [ApiHost, ClientKey] {\n    return [\n      (this._ctx.apiHost || \"https://cdn.growthbook.io\").replace(/\\/*$/, \"\"),\n      this._ctx.clientKey || \"\",\n    ];\n  }\n\n  private async _refresh(\n    options?: RefreshFeaturesOptions,\n    allowStale?: boolean,\n    updateInstance?: boolean\n  ) {\n    options = options || {};\n    if (!this._ctx.clientKey) {\n      throw new Error(\"Missing clientKey\");\n    }\n    await refreshFeatures(\n      this,\n      options.timeout,\n      options.skipCache || this._ctx.enableDevMode,\n      allowStale,\n      updateInstance\n    );\n  }\n\n  private _render() {\n    if (this._renderer) {\n      this._renderer();\n    }\n  }\n\n  public setFeatures(features: Record<string, FeatureDefinition>) {\n    this._ctx.features = features;\n    this.ready = true;\n    this._render();\n  }\n\n  public async setEncryptedFeatures(\n    encryptedString: string,\n    decryptionKey?: string,\n    subtle?: SubtleCrypto\n  ): Promise<void> {\n    const featuresJSON = await decrypt(\n      encryptedString,\n      decryptionKey || this._ctx.decryptionKey,\n      subtle\n    );\n    this.setFeatures(\n      JSON.parse(featuresJSON) as Record<string, FeatureDefinition>\n    );\n  }\n\n  public setExperiments(experiments: AutoExperiment[]): void {\n    this._ctx.experiments = experiments;\n    this.ready = true;\n    this._updateAllAutoExperiments();\n  }\n\n  public async setEncryptedExperiments(\n    encryptedString: string,\n    decryptionKey?: string,\n    subtle?: SubtleCrypto\n  ): Promise<void> {\n    const experimentsJSON = await decrypt(\n      encryptedString,\n      decryptionKey || this._ctx.decryptionKey,\n      subtle\n    );\n    this.setExperiments(JSON.parse(experimentsJSON) as AutoExperiment[]);\n  }\n\n  public setAttributes(attributes: Attributes) {\n    this._ctx.attributes = attributes;\n    this._render();\n    this._updateAllAutoExperiments();\n  }\n\n  public setAttributeOverrides(overrides: Attributes) {\n    this._attributeOverrides = overrides;\n    this._render();\n    this._updateAllAutoExperiments();\n  }\n  public setForcedVariations(vars: Record<string, number>) {\n    this._ctx.forcedVariations = vars || {};\n    this._render();\n    this._updateAllAutoExperiments();\n  }\n  // eslint-disable-next-line\n  public setForcedFeatures(map: Map<string, any>) {\n    this._forcedFeatureValues = map;\n    this._render();\n  }\n\n  public setURL(url: string) {\n    this._ctx.url = url;\n    this._updateAllAutoExperiments(true);\n  }\n\n  public getAttributes() {\n    return { ...this._ctx.attributes, ...this._attributeOverrides };\n  }\n\n  public getFeatures() {\n    return this._ctx.features || {};\n  }\n\n  public getExperiments() {\n    return this._ctx.experiments || [];\n  }\n\n  public subscribe(cb: SubscriptionFunction): () => void {\n    this._subscriptions.add(cb);\n\n    return () => {\n      this._subscriptions.delete(cb);\n    };\n  }\n\n  public getAllResults() {\n    return new Map(this._assigned);\n  }\n\n  public destroy() {\n    // Release references to save memory\n    this._subscriptions.clear();\n    this._assigned.clear();\n    this._trackedExperiments.clear();\n    this._trackedFeatures = {};\n    this._rtQueue = [];\n    if (this._rtTimer) {\n      clearTimeout(this._rtTimer);\n    }\n    unsubscribe(this);\n\n    if (isBrowser && window._growthbook === this) {\n      delete window._growthbook;\n    }\n\n    // Undo any active auto experiments\n    this._activeAutoExperiments.forEach((exp) => {\n      exp.undo();\n    });\n    this._activeAutoExperiments.clear();\n  }\n\n  public setRenderer(renderer: () => void) {\n    this._renderer = renderer;\n  }\n\n  public forceVariation(key: string, variation: number) {\n    this._ctx.forcedVariations = this._ctx.forcedVariations || {};\n    this._ctx.forcedVariations[key] = variation;\n    this._render();\n  }\n\n  public run<T>(experiment: Experiment<T>): Result<T> {\n    const result = this._run(experiment, null);\n    this._fireSubscriptions(experiment, result);\n    return result;\n  }\n\n  public triggerExperiment(key: string) {\n    if (!this._ctx.experiments) return null;\n    const exp = this._ctx.experiments.find((exp) => exp.key === key);\n    if (!exp || !exp.manual) return null;\n    return this._runAutoExperiment(exp, true);\n  }\n\n  private _runAutoExperiment(\n    experiment: AutoExperiment,\n    forceManual?: boolean,\n    forceRerun?: boolean\n  ) {\n    const key = experiment.key;\n    const existing = this._activeAutoExperiments.get(key);\n\n    // If this is a manual experiment and it's not already running, skip\n    if (experiment.manual && !forceManual && !existing) return null;\n\n    // Run the experiment\n    const result = this.run(experiment);\n\n    // A hash to quickly tell if the assigned value changed\n    const valueHash = JSON.stringify(result.value);\n\n    // If the changes are already active, no need to re-apply them\n    if (\n      !forceRerun &&\n      result.inExperiment &&\n      existing &&\n      existing.valueHash === valueHash\n    ) {\n      return result;\n    }\n\n    // Undo any existing changes\n    if (existing) this._undoActiveAutoExperiment(key);\n\n    // Apply new changes\n    if (result.inExperiment) {\n      const undo = this._applyDOMChanges(result.value);\n      if (undo) {\n        this._activeAutoExperiments.set(experiment.key, {\n          undo,\n          valueHash,\n        });\n      }\n    }\n\n    return result;\n  }\n\n  private _undoActiveAutoExperiment(key: string) {\n    const exp = this._activeAutoExperiments.get(key);\n    if (exp) {\n      exp.undo();\n      this._activeAutoExperiments.delete(key);\n    }\n  }\n\n  private _updateAllAutoExperiments(forceRerun?: boolean) {\n    const experiments = this._ctx.experiments || [];\n\n    // Stop any experiments that are no longer defined\n    const keys = new Set(experiments.map((e) => e.key));\n    this._activeAutoExperiments.forEach((v, k) => {\n      if (!keys.has(k)) {\n        v.undo();\n        this._activeAutoExperiments.delete(k);\n      }\n    });\n\n    // Re-run all new/updated experiments\n    experiments.forEach((exp) => {\n      this._runAutoExperiment(exp, false, forceRerun);\n    });\n  }\n\n  private _fireSubscriptions<T>(experiment: Experiment<T>, result: Result<T>) {\n    const key = experiment.key;\n\n    // If assigned variation has changed, fire subscriptions\n    const prev = this._assigned.get(key);\n    // TODO: what if the experiment definition has changed?\n    if (\n      !prev ||\n      prev.result.inExperiment !== result.inExperiment ||\n      prev.result.variationId !== result.variationId\n    ) {\n      this._assigned.set(key, { experiment, result });\n      this._subscriptions.forEach((cb) => {\n        try {\n          cb(experiment, result);\n        } catch (e) {\n          console.error(e);\n        }\n      });\n    }\n  }\n\n  private _trackFeatureUsage(key: string, res: FeatureResult): void {\n    // Don't track feature usage that was forced via an override\n    if (res.source === \"override\") return;\n\n    // Only track a feature once, unless the assigned value changed\n    const stringifiedValue = JSON.stringify(res.value);\n    if (this._trackedFeatures[key] === stringifiedValue) return;\n    this._trackedFeatures[key] = stringifiedValue;\n\n    // Fire user-supplied callback\n    if (this._ctx.onFeatureUsage) {\n      try {\n        this._ctx.onFeatureUsage(key, res);\n      } catch (e) {\n        // Ignore feature usage callback errors\n      }\n    }\n\n    // In browser environments, queue up feature usage to be tracked in batches\n    if (!isBrowser || !window.fetch) return;\n    this._rtQueue.push({\n      key,\n      on: res.on,\n    });\n    if (!this._rtTimer) {\n      this._rtTimer = window.setTimeout(() => {\n        // Reset the queue\n        this._rtTimer = 0;\n        const q = [...this._rtQueue];\n        this._rtQueue = [];\n\n        // Skip logging if a real-time usage key is not configured\n        if (!this._ctx.realtimeKey) return;\n\n        window\n          .fetch(\n            `https://rt.growthbook.io/?key=${\n              this._ctx.realtimeKey\n            }&events=${encodeURIComponent(JSON.stringify(q))}`,\n\n            {\n              cache: \"no-cache\",\n              mode: \"no-cors\",\n            }\n          )\n          .catch(() => {\n            // TODO: retry in case of network errors?\n          });\n      }, this._ctx.realtimeInterval || 2000);\n    }\n  }\n\n  private _getFeatureResult<T>(\n    key: string,\n    value: T,\n    source: FeatureResultSource,\n    ruleId?: string,\n    experiment?: Experiment<T>,\n    result?: Result<T>\n  ): FeatureResult<T> {\n    const ret: FeatureResult = {\n      value,\n      on: !!value,\n      off: !value,\n      source,\n      ruleId: ruleId || \"\",\n    };\n    if (experiment) ret.experiment = experiment;\n    if (result) ret.experimentResult = result;\n\n    // Track the usage of this feature in real-time\n    this._trackFeatureUsage(key, ret);\n\n    return ret;\n  }\n\n  public isOn<K extends string & keyof AppFeatures = string>(key: K): boolean {\n    return this.evalFeature(key).on;\n  }\n\n  public isOff<K extends string & keyof AppFeatures = string>(key: K): boolean {\n    return this.evalFeature(key).off;\n  }\n\n  public getFeatureValue<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(key: K, defaultValue: V): WidenPrimitives<V> {\n    const value = this.evalFeature<WidenPrimitives<V>, K>(key).value;\n    return value === null ? (defaultValue as WidenPrimitives<V>) : value;\n  }\n\n  /**\n   * @deprecated Use {@link evalFeature}\n   * @param id\n   */\n  // eslint-disable-next-line\n  public feature<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(id: K): FeatureResult<V | null> {\n    return this.evalFeature(id);\n  }\n\n  public evalFeature<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(id: K): FeatureResult<V | null> {\n    // Global override\n    if (this._forcedFeatureValues.has(id)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Global override\", {\n          id,\n          value: this._forcedFeatureValues.get(id),\n        });\n      return this._getFeatureResult(\n        id,\n        this._forcedFeatureValues.get(id),\n        \"override\"\n      );\n    }\n\n    // Unknown feature id\n    if (!this._ctx.features || !this._ctx.features[id]) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Unknown feature\", { id });\n      return this._getFeatureResult(id, null, \"unknownFeature\");\n    }\n\n    // Get the feature\n    const feature: FeatureDefinition<V> = this._ctx.features[id];\n\n    // Loop through the rules\n    if (feature.rules) {\n      for (const rule of feature.rules) {\n        // If it's a conditional rule, skip if the condition doesn't pass\n        if (rule.condition && !this._conditionPasses(rule.condition)) {\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Skip rule because of condition\", {\n              id,\n              rule,\n            });\n          continue;\n        }\n        // If there are filters for who is included (e.g. namespaces)\n        if (rule.filters && this._isFilteredOut(rule.filters)) {\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Skip rule because of filters\", {\n              id,\n              rule,\n            });\n          continue;\n        }\n\n        // Feature value is being forced\n        if (\"force\" in rule) {\n          // If this is a percentage rollout, skip if not included\n          if (\n            !this._isIncludedInRollout(\n              rule.seed || id,\n              rule.hashAttribute,\n              rule.range,\n              rule.coverage,\n              rule.hashVersion\n            )\n          ) {\n            process.env.NODE_ENV !== \"production\" &&\n              this.log(\"Skip rule because user not included in rollout\", {\n                id,\n                rule,\n              });\n            continue;\n          }\n\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Force value from rule\", {\n              id,\n              rule,\n            });\n\n          // If this was a remotely evaluated experiment, fire the tracking callbacks\n          if (rule.tracks) {\n            rule.tracks.forEach((t) => {\n              this._track(t.experiment, t.result);\n            });\n          }\n\n          return this._getFeatureResult(id, rule.force as V, \"force\", rule.id);\n        }\n        if (!rule.variations) {\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Skip invalid rule\", {\n              id,\n              rule,\n            });\n\n          continue;\n        }\n        // For experiment rules, run an experiment\n        const exp: Experiment<V> = {\n          variations: rule.variations as [V, V, ...V[]],\n          key: rule.key || id,\n        };\n        if (\"coverage\" in rule) exp.coverage = rule.coverage;\n        if (rule.weights) exp.weights = rule.weights;\n        if (rule.hashAttribute) exp.hashAttribute = rule.hashAttribute;\n        if (rule.namespace) exp.namespace = rule.namespace;\n        if (rule.meta) exp.meta = rule.meta;\n        if (rule.ranges) exp.ranges = rule.ranges;\n        if (rule.name) exp.name = rule.name;\n        if (rule.phase) exp.phase = rule.phase;\n        if (rule.seed) exp.seed = rule.seed;\n        if (rule.hashVersion) exp.hashVersion = rule.hashVersion;\n        if (rule.filters) exp.filters = rule.filters;\n\n        // Only return a value if the user is part of the experiment\n        const res = this._run(exp, id);\n        this._fireSubscriptions(exp, res);\n        if (res.inExperiment && !res.passthrough) {\n          return this._getFeatureResult(\n            id,\n            res.value,\n            \"experiment\",\n            rule.id,\n            exp,\n            res\n          );\n        }\n      }\n    }\n\n    process.env.NODE_ENV !== \"production\" &&\n      this.log(\"Use default value\", {\n        id,\n        value: feature.defaultValue,\n      });\n\n    // Fall back to using the default value\n    return this._getFeatureResult(\n      id,\n      feature.defaultValue === undefined ? null : feature.defaultValue,\n      \"defaultValue\"\n    );\n  }\n\n  private _isIncludedInRollout(\n    seed: string,\n    hashAttribute: string | undefined,\n    range: VariationRange | undefined,\n    coverage: number | undefined,\n    hashVersion: number | undefined\n  ): boolean {\n    if (!range && coverage === undefined) return true;\n\n    const { hashValue } = this._getHashAttribute(hashAttribute);\n    if (!hashValue) {\n      return false;\n    }\n\n    const n = hash(seed, hashValue, hashVersion || 1);\n    if (n === null) return false;\n\n    return range\n      ? inRange(n, range)\n      : coverage !== undefined\n      ? n <= coverage\n      : true;\n  }\n\n  private _conditionPasses(condition: ConditionInterface): boolean {\n    return evalCondition(this.getAttributes(), condition);\n  }\n\n  private _isFilteredOut(filters: Filter[]): boolean {\n    return filters.some((filter) => {\n      const { hashValue } = this._getHashAttribute(filter.attribute);\n      if (!hashValue) return true;\n      const n = hash(filter.seed, hashValue, filter.hashVersion || 2);\n      if (n === null) return true;\n      return !filter.ranges.some((r) => inRange(n, r));\n    });\n  }\n\n  private _run<T>(\n    experiment: Experiment<T>,\n    featureId: string | null\n  ): Result<T> {\n    const key = experiment.key;\n    const numVariations = experiment.variations.length;\n\n    // 1. If experiment has less than 2 variations, return immediately\n    if (numVariations < 2) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Invalid experiment\", { id: key });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 2. If the context is disabled, return immediately\n    if (this._ctx.enabled === false) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Context disabled\", { id: key });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 2.5. Merge in experiment overrides from the context\n    experiment = this._mergeOverrides(experiment);\n\n    // 3. If a variation is forced from a querystring, return the forced variation\n    const qsOverride = getQueryStringOverride(\n      key,\n      this._getContextUrl(),\n      numVariations\n    );\n    if (qsOverride !== null) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Force via querystring\", {\n          id: key,\n          variation: qsOverride,\n        });\n      return this._getResult(experiment, qsOverride, false, featureId);\n    }\n\n    // 4. If a variation is forced in the context, return the forced variation\n    if (this._ctx.forcedVariations && key in this._ctx.forcedVariations) {\n      const variation = this._ctx.forcedVariations[key];\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Force via dev tools\", {\n          id: key,\n          variation,\n        });\n      return this._getResult(experiment, variation, false, featureId);\n    }\n\n    // 5. Exclude if a draft experiment or not active\n    if (experiment.status === \"draft\" || experiment.active === false) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because inactive\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 6. Get the hash attribute and return if empty\n    const { hashValue } = this._getHashAttribute(experiment.hashAttribute);\n    if (!hashValue) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because missing hashAttribute\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 7. Exclude if user is filtered out (used to be called \"namespace\")\n    if (experiment.filters) {\n      if (this._isFilteredOut(experiment.filters)) {\n        process.env.NODE_ENV !== \"production\" &&\n          this.log(\"Skip because of filters\", {\n            id: key,\n          });\n        return this._getResult(experiment, -1, false, featureId);\n      }\n    } else if (\n      experiment.namespace &&\n      !inNamespace(hashValue, experiment.namespace)\n    ) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of namespace\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 7.5. Exclude if experiment.include returns false or throws\n    if (experiment.include && !isIncluded(experiment.include)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of include function\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 8. Exclude if condition is false\n    if (experiment.condition && !this._conditionPasses(experiment.condition)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of condition\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 8.1. Exclude if user is not in a required group\n    if (\n      experiment.groups &&\n      !this._hasGroupOverlap(experiment.groups as string[])\n    ) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of groups\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 8.2. Old style URL targeting\n    if (experiment.url && !this._urlIsValid(experiment.url as RegExp)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of url\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 8.3. New, more powerful URL targeting\n    if (\n      experiment.urlPatterns &&\n      !isURLTargeted(this._getContextUrl(), experiment.urlPatterns)\n    ) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of url targeting\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 9. Get bucket ranges and choose variation\n    const n = hash(\n      experiment.seed || key,\n      hashValue,\n      experiment.hashVersion || 1\n    );\n    if (n === null) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of invalid hash version\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    const ranges =\n      experiment.ranges ||\n      getBucketRanges(\n        numVariations,\n        experiment.coverage === undefined ? 1 : experiment.coverage,\n        experiment.weights\n      );\n\n    const assigned = chooseVariation(n, ranges);\n\n    // 10. Return if not in experiment\n    if (assigned < 0) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of coverage\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 11. Experiment has a forced variation\n    if (\"force\" in experiment) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Force variation\", {\n          id: key,\n          variation: experiment.force,\n        });\n      return this._getResult(\n        experiment,\n        experiment.force === undefined ? -1 : experiment.force,\n        false,\n        featureId\n      );\n    }\n\n    // 12. Exclude if in QA mode\n    if (this._ctx.qaMode) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because QA mode\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 12.5. Exclude if experiment is stopped\n    if (experiment.status === \"stopped\") {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because stopped\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 13. Build the result object\n    const result = this._getResult(experiment, assigned, true, featureId, n);\n\n    // 14. Fire the tracking callback\n    this._track(experiment, result);\n\n    // 15. Return the result\n    process.env.NODE_ENV !== \"production\" &&\n      this.log(\"In experiment\", {\n        id: key,\n        variation: result.variationId,\n      });\n    return result;\n  }\n\n  log(msg: string, ctx: Record<string, unknown>) {\n    if (!this.debug) return;\n    if (this._ctx.log) this._ctx.log(msg, ctx);\n    else console.log(msg, ctx);\n  }\n\n  private _track<T>(experiment: Experiment<T>, result: Result<T>) {\n    if (!this._ctx.trackingCallback) return;\n\n    const key = experiment.key;\n\n    // Make sure a tracking callback is only fired once per unique experiment\n    const k =\n      result.hashAttribute + result.hashValue + key + result.variationId;\n    if (this._trackedExperiments.has(k)) return;\n    this._trackedExperiments.add(k);\n\n    try {\n      this._ctx.trackingCallback(experiment, result);\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  private _mergeOverrides<T>(experiment: Experiment<T>): Experiment<T> {\n    const key = experiment.key;\n    const o = this._ctx.overrides;\n    if (o && o[key]) {\n      experiment = Object.assign({}, experiment, o[key]);\n      if (typeof experiment.url === \"string\") {\n        experiment.url = getUrlRegExp(\n          // eslint-disable-next-line\n          experiment.url as any\n        );\n      }\n    }\n\n    return experiment;\n  }\n\n  private _getHashAttribute(attr?: string) {\n    const hashAttribute = attr || \"id\";\n\n    let hashValue = \"\";\n    if (this._attributeOverrides[hashAttribute]) {\n      hashValue = this._attributeOverrides[hashAttribute];\n    } else if (this._ctx.attributes) {\n      hashValue = this._ctx.attributes[hashAttribute] || \"\";\n    } else if (this._ctx.user) {\n      hashValue = this._ctx.user[hashAttribute] || \"\";\n    }\n\n    return { hashAttribute, hashValue };\n  }\n\n  private _getResult<T>(\n    experiment: Experiment<T>,\n    variationIndex: number,\n    hashUsed: boolean,\n    featureId: string | null,\n    bucket?: number\n  ): Result<T> {\n    let inExperiment = true;\n    // If assigned variation is not valid, use the baseline and mark the user as not in the experiment\n    if (variationIndex < 0 || variationIndex >= experiment.variations.length) {\n      variationIndex = 0;\n      inExperiment = false;\n    }\n\n    const { hashAttribute, hashValue } = this._getHashAttribute(\n      experiment.hashAttribute\n    );\n\n    const meta: Partial<VariationMeta> = experiment.meta\n      ? experiment.meta[variationIndex]\n      : {};\n\n    const res: Result<T> = {\n      key: meta.key || \"\" + variationIndex,\n      featureId,\n      inExperiment,\n      hashUsed,\n      variationId: variationIndex,\n      value: experiment.variations[variationIndex],\n      hashAttribute,\n      hashValue,\n    };\n\n    if (meta.name) res.name = meta.name;\n    if (bucket !== undefined) res.bucket = bucket;\n    if (meta.passthrough) res.passthrough = meta.passthrough;\n\n    return res;\n  }\n\n  private _getContextUrl() {\n    return this._ctx.url || (isBrowser ? window.location.href : \"\");\n  }\n\n  private _urlIsValid(urlRegex: RegExp): boolean {\n    const url = this._getContextUrl();\n    if (!url) return false;\n\n    const pathOnly = url.replace(/^https?:\\/\\//, \"\").replace(/^[^/]*\\//, \"/\");\n\n    if (urlRegex.test(url)) return true;\n    if (urlRegex.test(pathOnly)) return true;\n    return false;\n  }\n\n  private _hasGroupOverlap(expGroups: string[]): boolean {\n    const groups = this._ctx.groups || {};\n    for (let i = 0; i < expGroups.length; i++) {\n      if (groups[expGroups[i]]) return true;\n    }\n    return false;\n  }\n\n  private _applyDOMChanges(changes: AutoExperimentVariation) {\n    if (!isBrowser) return;\n    const undo: (() => void)[] = [];\n    if (changes.css) {\n      const s = document.createElement(\"style\");\n      s.innerHTML = changes.css;\n      document.head.appendChild(s);\n      undo.push(() => s.remove());\n    }\n    if (changes.js) {\n      const script = document.createElement(\"script\");\n      script.innerHTML = changes.js;\n      document.body.appendChild(script);\n      undo.push(() => script.remove());\n    }\n    if (changes.domMutations) {\n      changes.domMutations.forEach((mutation) => {\n        undo.push(mutate.declarative(mutation as DeclarativeMutation).revert);\n      });\n    }\n    return () => {\n      undo.forEach((fn) => fn());\n    };\n  }\n}\n"],"names":["cacheSettings","staleTTL","cacheKey","backgroundSync","polyfills","fetch","globalThis","bind","undefined","SubtleCrypto","crypto","subtle","EventSource","localStorage","e","subscribedInstances","Map","cacheInitialized","cache","activeFetches","streams","supportsSSE","Set","setPolyfills","overrides","Object","assign","configureCache","clearAutoRefresh","clearCache","clear","updatePersistentCache","refreshFeatures","instance","timeout","skipCache","allowStale","updateInstance","data","fetchFeaturesWithCache","refreshInstance","subscribe","key","getKey","subs","get","add","set","unsubscribe","forEach","s","delete","setItem","JSON","stringify","Array","from","entries","now","Date","initializeCache","existing","staleAt","fetchFeatures","startAutoRefresh","promiseTimeout","apiHost","clientKey","getApiInfo","promise","Promise","resolve","resolved","timer","finish","clearTimeout","setTimeout","then","catch","value","getItem","parsed","parse","isArray","onNewFeatureData","version","dateUpdated","instances","encryptedExperiments","setEncryptedExperiments","setExperiments","experiments","getExperiments","encryptedFeatures","setEncryptedFeatures","setFeatures","features","getFeatures","endpoint","res","headers","json","has","channel","src","cb","event","errors","onSSEError","enableChannel","readyState","delay","Math","pow","random","disableChannel","min","onopen","onerror","close","addEventListener","destroyChannel","validAttributeName","nullController","revert","elements","mutations","getObserverInit","attr","childList","subtree","attributes","characterData","attributeFilter","getElementRecord","element","record","createElementPropertyRecord","el","getCurrentValue","setValue","mutationRunner","currentValue","isDirty","originalValue","virtualValue","observer","MutationObserver","observe","queueIfNeeded","val","currentVal","parentNode","insertBeforeNode","queueDOMUpdates","htmlMutationRunner","m","mutate","getTransformedHTML","classMutationRunner","split","filter","Boolean","join","attrMutationRunner","_loadDOMNodes","parentSelector","insertBeforeSelector","document","querySelector","positionMutationRunner","selectors","newNodes","getHTMLValue","innerHTML","setHTMLValue","getElementHTMLRecord","elementRecord","html","getElementPosition","parentElement","nextElementSibling","setElementPosition","insertBefore","getElementPositionRecord","position","setClassValue","className","removeAttribute","getClassValue","getElementClassRecord","classes","getAttrValue","attrName","getAttribute","setAttrValue","setAttribute","getElementAttributeRecord","deleteElementPropertyRecord","disconnect","transformContainer","createElement","setPropertyValue","length","raf","keys","setValues","requestAnimationFrame","startMutating","mutation","kind","attribute","push","stopMutating","index","indexOf","splice","refreshElementsSet","existingElements","newElements","matchingElements","querySelectorAll","selector","revertMutation","refreshAllElementSets","connectGlobalObserver","documentElement","newMutation","test","mutatedClassnames","classnames","c","declarative","action","hashFnv32a","str","hval","l","i","charCodeAt","hash","seed","getEqualWeights","n","fill","inRange","range","inNamespace","hashValue","namespace","chooseVariation","ranges","getUrlRegExp","regexString","escaped","replace","RegExp","console","error","isURLTargeted","url","targets","hasIncludeRules","isIncluded","match","_evalURLTarget","type","pattern","include","_evalSimpleUrlPart","actual","isPath","regex","_evalSimpleUrlTarget","expected","URL","comps","host","pathname","searchParams","v","k","some","href","substring","origin","getBucketRanges","numVariations","coverage","weights","equal","totalWeight","reduce","w","sum","cumulative","map","start","getQueryStringOverride","id","search","kv","parseInt","base64ToBuf","b","Uint8Array","atob","decrypt","encryptedString","decryptionKey","Error","importKey","name","iv","cipherText","plainTextBuffer","TextDecoder","decode","paddedVersionString","input","parts","padStart","_regexCache","evalCondition","obj","condition","evalOr","evalAnd","evalConditionValue","getPath","path","current","getRegex","isOperatorObject","op","evalOperatorCondition","getType","t","includes","elemMatch","check","isIn","operator","passed","j","conditions","isBrowser","window","GrowthBook","constructor","context","_ctx","_renderer","_trackedExperiments","_trackedFeatures","debug","_subscriptions","_rtQueue","_rtTimer","ready","_assigned","_forcedFeatureValues","_attributeOverrides","_activeAutoExperiments","enableDevMode","_growthbook","dispatchEvent","Event","_updateAllAutoExperiments","_refresh","loadFeatures","options","autoRefresh","_render","featuresJSON","experimentsJSON","setAttributes","setAttributeOverrides","setForcedVariations","vars","forcedVariations","setForcedFeatures","setURL","getAttributes","getAllResults","destroy","exp","undo","setRenderer","renderer","forceVariation","variation","run","experiment","result","_run","_fireSubscriptions","triggerExperiment","find","manual","_runAutoExperiment","forceManual","forceRerun","valueHash","inExperiment","_undoActiveAutoExperiment","_applyDOMChanges","prev","variationId","_trackFeatureUsage","source","stringifiedValue","onFeatureUsage","on","q","realtimeKey","encodeURIComponent","mode","realtimeInterval","_getFeatureResult","ruleId","ret","off","experimentResult","isOn","evalFeature","isOff","getFeatureValue","defaultValue","feature","rules","rule","_conditionPasses","filters","_isFilteredOut","_isIncludedInRollout","hashAttribute","hashVersion","tracks","_track","force","variations","meta","phase","passthrough","_getHashAttribute","r","featureId","_getResult","enabled","_mergeOverrides","qsOverride","_getContextUrl","status","active","groups","_hasGroupOverlap","_urlIsValid","urlPatterns","assigned","qaMode","log","msg","ctx","trackingCallback","o","user","variationIndex","hashUsed","bucket","location","urlRegex","pathOnly","expGroups","changes","css","head","appendChild","remove","js","script","body","domMutations","fn"],"mappings":"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"}