{"version":3,"file":"esm.min.js","sources":["../../src/feature-repository.ts","../../../../node_modules/dom-mutator/dist/dom-mutator.esm.js","../../src/util.ts","../../src/mongrule.ts","../../src/GrowthBook.ts"],"sourcesContent":["import {\n  ApiHost,\n  CacheSettings,\n  ClientKey,\n  FeatureApiResponse,\n  Polyfills,\n  RepositoryKey,\n} from \"./types/growthbook\";\nimport type { GrowthBook } from \".\";\n\ntype CacheEntry = {\n  data: FeatureApiResponse;\n  version: string;\n  staleAt: Date;\n};\ntype ScopedChannel = {\n  src: EventSource | null;\n  cb: (event: MessageEvent<string>) => void;\n  errors: number;\n};\n\n// Config settings\nconst cacheSettings: CacheSettings = {\n  // Consider a fetch stale after 1 minute\n  staleTTL: 1000 * 60,\n  cacheKey: \"gbFeaturesCache\",\n  backgroundSync: true,\n};\nconst polyfills: Polyfills = {\n  fetch: globalThis.fetch ? globalThis.fetch.bind(globalThis) : undefined,\n  SubtleCrypto: globalThis.crypto ? globalThis.crypto.subtle : undefined,\n  EventSource: globalThis.EventSource,\n};\ntry {\n  if (globalThis.localStorage) {\n    polyfills.localStorage = globalThis.localStorage;\n  }\n} catch (e) {\n  // Ignore localStorage errors\n}\n\n// Global state\nconst subscribedInstances: Map<RepositoryKey, Set<GrowthBook>> = new Map();\nlet cacheInitialized = false;\nconst cache: Map<RepositoryKey, CacheEntry> = new Map();\nconst activeFetches: Map<\n  RepositoryKey,\n  Promise<FeatureApiResponse>\n> = new Map();\nconst streams: Map<RepositoryKey, ScopedChannel> = new Map();\nconst supportsSSE: Set<RepositoryKey> = new Set();\n\n// Public functions\nexport function setPolyfills(overrides: Partial<Polyfills>): void {\n  Object.assign(polyfills, overrides);\n}\nexport function configureCache(overrides: Partial<CacheSettings>): void {\n  Object.assign(cacheSettings, overrides);\n  if (!cacheSettings.backgroundSync) {\n    clearAutoRefresh();\n  }\n}\n\nexport async function clearCache(): Promise<void> {\n  cache.clear();\n  activeFetches.clear();\n  clearAutoRefresh();\n  cacheInitialized = false;\n  await updatePersistentCache();\n}\n\nexport async function refreshFeatures(\n  instance: GrowthBook,\n  timeout?: number,\n  skipCache?: boolean,\n  allowStale?: boolean,\n  updateInstance?: boolean\n): Promise<void> {\n  const data = await fetchFeaturesWithCache(\n    instance,\n    allowStale,\n    timeout,\n    skipCache\n  );\n  updateInstance && data && (await refreshInstance(instance, data));\n}\n\n// Subscribe a GrowthBook instance to feature changes\nexport function subscribe(instance: GrowthBook): void {\n  const [key] = getKey(instance);\n  const subs = subscribedInstances.get(key) || new Set();\n  subs.add(instance);\n  subscribedInstances.set(key, subs);\n}\nexport function unsubscribe(instance: GrowthBook): void {\n  subscribedInstances.forEach((s) => s.delete(instance));\n}\n\n// Private functions\nasync function updatePersistentCache() {\n  try {\n    if (!polyfills.localStorage) return;\n    await polyfills.localStorage.setItem(\n      cacheSettings.cacheKey,\n      JSON.stringify(Array.from(cache.entries()))\n    );\n  } catch (e) {\n    // Ignore localStorage errors\n  }\n}\n\nasync function fetchFeaturesWithCache(\n  instance: GrowthBook,\n  allowStale?: boolean,\n  timeout?: number,\n  skipCache?: boolean\n): Promise<FeatureApiResponse | null> {\n  const [key] = getKey(instance);\n  const now = new Date();\n  await initializeCache();\n  const existing = cache.get(key);\n  if (existing && !skipCache && (allowStale || existing.staleAt > now)) {\n    // Reload features in the backgroud if stale\n    if (existing.staleAt < now) {\n      fetchFeatures(instance);\n    }\n    // Otherwise, if we don't need to refresh now, start a background sync\n    else {\n      startAutoRefresh(instance);\n    }\n    return existing.data;\n  } else {\n    const data = await promiseTimeout(fetchFeatures(instance), timeout);\n    return data;\n  }\n}\n\nfunction getKey(instance: GrowthBook): [RepositoryKey, ApiHost, ClientKey] {\n  const [apiHost, clientKey] = instance.getApiInfo();\n  return [`${apiHost}||${clientKey}`, apiHost, clientKey];\n}\n\n// Guarantee the promise always resolves within {timeout} ms\n// Resolved value will be `null` when there's an error or it takes too long\n// Note: The promise will continue running in the background, even if the timeout is hit\nfunction promiseTimeout<T>(\n  promise: Promise<T>,\n  timeout?: number\n): Promise<T | null> {\n  return new Promise((resolve) => {\n    let resolved = false;\n    let timer: unknown;\n    const finish = (data?: T) => {\n      if (resolved) return;\n      resolved = true;\n      timer && clearTimeout(timer as NodeJS.Timer);\n      resolve(data || null);\n    };\n\n    if (timeout) {\n      timer = setTimeout(() => finish(), timeout);\n    }\n\n    promise.then((data) => finish(data)).catch(() => finish());\n  });\n}\n\n// Populate cache from localStorage (if available)\nasync function initializeCache(): Promise<void> {\n  if (cacheInitialized) return;\n  cacheInitialized = true;\n  try {\n    if (polyfills.localStorage) {\n      const value = await polyfills.localStorage.getItem(\n        cacheSettings.cacheKey\n      );\n      if (value) {\n        const parsed: [RepositoryKey, CacheEntry][] = JSON.parse(value);\n        if (parsed && Array.isArray(parsed)) {\n          parsed.forEach(([key, data]) => {\n            cache.set(key, {\n              ...data,\n              staleAt: new Date(data.staleAt),\n            });\n          });\n        }\n      }\n    }\n  } catch (e) {\n    // Ignore localStorage errors\n  }\n}\n\n// Called whenever new features are fetched from the API\nfunction onNewFeatureData(key: RepositoryKey, data: FeatureApiResponse): void {\n  // If contents haven't changed, ignore the update, extend the stale TTL\n  const version = data.dateUpdated || \"\";\n  const staleAt = new Date(Date.now() + cacheSettings.staleTTL);\n  const existing = cache.get(key);\n  if (existing && version && existing.version === version) {\n    existing.staleAt = staleAt;\n    updatePersistentCache();\n    return;\n  }\n\n  // Update in-memory cache\n  cache.set(key, {\n    data,\n    version,\n    staleAt,\n  });\n  // Update local storage (don't await this, just update asynchronously)\n  updatePersistentCache();\n\n  // Update features for all subscribed GrowthBook instances\n  const instances = subscribedInstances.get(key);\n  instances && instances.forEach((instance) => refreshInstance(instance, data));\n}\n\nasync function refreshInstance(\n  instance: GrowthBook,\n  data: FeatureApiResponse\n): Promise<void> {\n  await (data.encryptedExperiments\n    ? instance.setEncryptedExperiments(\n        data.encryptedExperiments,\n        undefined,\n        polyfills.SubtleCrypto\n      )\n    : instance.setExperiments(data.experiments || instance.getExperiments()));\n\n  await (data.encryptedFeatures\n    ? instance.setEncryptedFeatures(\n        data.encryptedFeatures,\n        undefined,\n        polyfills.SubtleCrypto\n      )\n    : instance.setFeatures(data.features || instance.getFeatures()));\n}\n\nasync function fetchFeatures(\n  instance: GrowthBook\n): Promise<FeatureApiResponse> {\n  const [key, apiHost, clientKey] = getKey(instance);\n  const endpoint = apiHost + \"/api/features/\" + clientKey;\n\n  let promise = activeFetches.get(key);\n  if (!promise) {\n    promise = (polyfills.fetch as typeof globalThis.fetch)(endpoint)\n      // TODO: auto-retry if status code indicates a temporary error\n      .then((res) => {\n        if (res.headers.get(\"x-sse-support\") === \"enabled\") {\n          supportsSSE.add(key);\n        }\n        return res.json();\n      })\n      .then((data: FeatureApiResponse) => {\n        onNewFeatureData(key, data);\n        startAutoRefresh(instance);\n        activeFetches.delete(key);\n        return data;\n      })\n      .catch((e) => {\n        process.env.NODE_ENV !== \"production\" &&\n          instance.log(\"Error fetching features\", {\n            apiHost,\n            clientKey,\n            error: e ? e.message : null,\n          });\n        activeFetches.delete(key);\n        return Promise.resolve({});\n      });\n    activeFetches.set(key, promise);\n  }\n  return await promise;\n}\n\n// Watch a feature endpoint for changes\n// Will prefer SSE if enabled, otherwise fall back to cron\nfunction startAutoRefresh(instance: GrowthBook): void {\n  const [key, apiHost, clientKey] = getKey(instance);\n  if (\n    cacheSettings.backgroundSync &&\n    supportsSSE.has(key) &&\n    polyfills.EventSource\n  ) {\n    if (streams.has(key)) return;\n    const channel: ScopedChannel = {\n      src: null,\n      cb: (event: MessageEvent<string>) => {\n        try {\n          const json: FeatureApiResponse = JSON.parse(event.data);\n          onNewFeatureData(key, json);\n          // Reset error count on success\n          channel.errors = 0;\n        } catch (e) {\n          process.env.NODE_ENV !== \"production\" &&\n            instance.log(\"SSE Error\", {\n              apiHost,\n              clientKey,\n              error: e ? (e as Error).message : null,\n            });\n          onSSEError(channel, apiHost, clientKey);\n        }\n      },\n      errors: 0,\n    };\n    streams.set(key, channel);\n    enableChannel(channel, apiHost, clientKey);\n  }\n}\n\nfunction onSSEError(\n  channel: ScopedChannel,\n  apiHost: string,\n  clientKey: string\n) {\n  channel.errors++;\n  if (channel.errors > 3 || (channel.src && channel.src.readyState === 2)) {\n    // exponential backoff after 4 errors, with jitter\n    const delay =\n      Math.pow(3, channel.errors - 3) * (1000 + Math.random() * 1000);\n    disableChannel(channel);\n    setTimeout(() => {\n      enableChannel(channel, apiHost, clientKey);\n    }, Math.min(delay, 300000)); // 5 minutes max\n  }\n}\n\nfunction disableChannel(channel: ScopedChannel) {\n  if (!channel.src) return;\n  channel.src.onopen = null;\n  channel.src.onerror = null;\n  channel.src.close();\n  channel.src = null;\n}\n\nfunction enableChannel(\n  channel: ScopedChannel,\n  apiHost: string,\n  clientKey: string\n) {\n  channel.src = new polyfills.EventSource(\n    `${apiHost}/sub/${clientKey}`\n  ) as EventSource;\n  channel.src.addEventListener(\"features\", channel.cb);\n  channel.src.onerror = () => {\n    onSSEError(channel, apiHost, clientKey);\n  };\n  channel.src.onopen = () => {\n    channel.errors = 0;\n  };\n}\n\nfunction destroyChannel(channel: ScopedChannel, key: RepositoryKey) {\n  disableChannel(channel);\n  streams.delete(key);\n}\n\nfunction clearAutoRefresh() {\n  // Clear list of which keys are auto-updated\n  supportsSSE.clear();\n\n  // Stop listening for any SSE events\n  streams.forEach(destroyChannel);\n\n  // Remove all references to GrowthBook instances\n  subscribedInstances.clear();\n}\n","var validAttributeName = /^[a-zA-Z:_][a-zA-Z0-9:_.-]*$/;\nvar nullController = {\n  revert: function revert() {}\n};\nvar elements = /*#__PURE__*/new Map();\nvar mutations = /*#__PURE__*/new Set();\n\nfunction getObserverInit(attr) {\n  return attr === 'html' ? {\n    childList: true,\n    subtree: true,\n    attributes: true,\n    characterData: true\n  } : {\n    childList: false,\n    subtree: false,\n    attributes: true,\n    attributeFilter: [attr]\n  };\n}\n\nfunction getElementRecord(element) {\n  var record = elements.get(element);\n\n  if (!record) {\n    record = {\n      element: element,\n      attributes: {}\n    };\n    elements.set(element, record);\n  }\n\n  return record;\n}\n\nfunction createElementPropertyRecord(el, attr, getCurrentValue, setValue, mutationRunner) {\n  var currentValue = getCurrentValue(el);\n  var record = {\n    isDirty: false,\n    originalValue: currentValue,\n    virtualValue: currentValue,\n    mutations: [],\n    el: el,\n    observer: new MutationObserver(function () {\n      var currentValue = getCurrentValue(el);\n      if (currentValue === record.virtualValue) return;\n      record.originalValue = currentValue;\n      mutationRunner(record);\n    }),\n    mutationRunner: mutationRunner,\n    setValue: setValue,\n    getCurrentValue: getCurrentValue\n  };\n  record.observer.observe(el, getObserverInit(attr));\n  return record;\n}\n\nfunction queueIfNeeded(val, record) {\n  var currentVal = record.getCurrentValue(record.el);\n  record.virtualValue = val;\n\n  if (val && typeof val !== 'string') {\n    if (!currentVal || val.parentNode !== currentVal.parentNode || val.insertBeforeNode !== currentVal.insertBeforeNode) {\n      record.isDirty = true;\n      queueDOMUpdates();\n    }\n  } else if (val !== currentVal) {\n    record.isDirty = true;\n    queueDOMUpdates();\n  }\n}\n\nfunction htmlMutationRunner(record) {\n  var val = record.originalValue;\n  record.mutations.forEach(function (m) {\n    return val = m.mutate(val);\n  });\n  queueIfNeeded(getTransformedHTML(val), record);\n}\n\nfunction classMutationRunner(record) {\n  var val = new Set(record.originalValue.split(/\\s+/).filter(Boolean));\n  record.mutations.forEach(function (m) {\n    return m.mutate(val);\n  });\n  queueIfNeeded(Array.from(val).filter(Boolean).join(' '), record);\n}\n\nfunction attrMutationRunner(record) {\n  var val = record.originalValue;\n  record.mutations.forEach(function (m) {\n    return val = m.mutate(val);\n  });\n  queueIfNeeded(val, record);\n}\n\nfunction _loadDOMNodes(_ref) {\n  var parentSelector = _ref.parentSelector,\n      insertBeforeSelector = _ref.insertBeforeSelector;\n  var parentNode = document.querySelector(parentSelector);\n  if (!parentNode) return null;\n  var insertBeforeNode = insertBeforeSelector ? document.querySelector(insertBeforeSelector) : null;\n  if (insertBeforeSelector && !insertBeforeNode) return null;\n  return {\n    parentNode: parentNode,\n    insertBeforeNode: insertBeforeNode\n  };\n}\n\nfunction positionMutationRunner(record) {\n  var val = record.originalValue;\n  record.mutations.forEach(function (m) {\n    var selectors = m.mutate();\n\n    var newNodes = _loadDOMNodes(selectors);\n\n    val = newNodes || val;\n  });\n  queueIfNeeded(val, record);\n}\n\nvar getHTMLValue = function getHTMLValue(el) {\n  return el.innerHTML;\n};\n\nvar setHTMLValue = function setHTMLValue(el, value) {\n  return el.innerHTML = value;\n};\n\nfunction getElementHTMLRecord(element) {\n  var elementRecord = getElementRecord(element);\n\n  if (!elementRecord.html) {\n    elementRecord.html = createElementPropertyRecord(element, 'html', getHTMLValue, setHTMLValue, htmlMutationRunner);\n  }\n\n  return elementRecord.html;\n}\n\nvar getElementPosition = function getElementPosition(el) {\n  return {\n    parentNode: el.parentElement,\n    insertBeforeNode: el.nextElementSibling\n  };\n};\n\nvar setElementPosition = function setElementPosition(el, value) {\n  value.parentNode.insertBefore(el, value.insertBeforeNode);\n};\n\nfunction getElementPositionRecord(element) {\n  var elementRecord = getElementRecord(element);\n\n  if (!elementRecord.position) {\n    elementRecord.position = createElementPropertyRecord(element, 'position', getElementPosition, setElementPosition, positionMutationRunner);\n  }\n\n  return elementRecord.position;\n}\n\nvar setClassValue = function setClassValue(el, val) {\n  return val ? el.className = val : el.removeAttribute('class');\n};\n\nvar getClassValue = function getClassValue(el) {\n  return el.className;\n};\n\nfunction getElementClassRecord(el) {\n  var elementRecord = getElementRecord(el);\n\n  if (!elementRecord.classes) {\n    elementRecord.classes = createElementPropertyRecord(el, 'class', getClassValue, setClassValue, classMutationRunner);\n  }\n\n  return elementRecord.classes;\n}\n\nvar getAttrValue = function getAttrValue(attrName) {\n  return function (el) {\n    var _el$getAttribute;\n\n    return (_el$getAttribute = el.getAttribute(attrName)) != null ? _el$getAttribute : null;\n  };\n};\n\nvar setAttrValue = function setAttrValue(attrName) {\n  return function (el, val) {\n    return val !== null ? el.setAttribute(attrName, val) : el.removeAttribute(attrName);\n  };\n};\n\nfunction getElementAttributeRecord(el, attr) {\n  var elementRecord = getElementRecord(el);\n\n  if (!elementRecord.attributes[attr]) {\n    elementRecord.attributes[attr] = createElementPropertyRecord(el, attr, getAttrValue(attr), setAttrValue(attr), attrMutationRunner);\n  }\n\n  return elementRecord.attributes[attr];\n}\n\nfunction deleteElementPropertyRecord(el, attr) {\n  var element = elements.get(el);\n  if (!element) return;\n\n  if (attr === 'html') {\n    var _element$html, _element$html$observe;\n\n    (_element$html = element.html) == null ? void 0 : (_element$html$observe = _element$html.observer) == null ? void 0 : _element$html$observe.disconnect();\n    delete element.html;\n  } else if (attr === 'class') {\n    var _element$classes, _element$classes$obse;\n\n    (_element$classes = element.classes) == null ? void 0 : (_element$classes$obse = _element$classes.observer) == null ? void 0 : _element$classes$obse.disconnect();\n    delete element.classes;\n  } else if (attr === 'position') {\n    var _element$position, _element$position$obs;\n\n    (_element$position = element.position) == null ? void 0 : (_element$position$obs = _element$position.observer) == null ? void 0 : _element$position$obs.disconnect();\n    delete element.position;\n  } else {\n    var _element$attributes, _element$attributes$a, _element$attributes$a2;\n\n    (_element$attributes = element.attributes) == null ? void 0 : (_element$attributes$a = _element$attributes[attr]) == null ? void 0 : (_element$attributes$a2 = _element$attributes$a.observer) == null ? void 0 : _element$attributes$a2.disconnect();\n    delete element.attributes[attr];\n  }\n}\n\nvar transformContainer;\n\nfunction getTransformedHTML(html) {\n  if (!transformContainer) {\n    transformContainer = document.createElement('div');\n  }\n\n  transformContainer.innerHTML = html;\n  return transformContainer.innerHTML;\n}\n\nfunction setPropertyValue(el, attr, m) {\n  if (!m.isDirty) return;\n  m.isDirty = false;\n  var val = m.virtualValue;\n\n  if (!m.mutations.length) {\n    deleteElementPropertyRecord(el, attr);\n  }\n\n  m.setValue(el, val);\n}\n\nvar raf = false;\n\nfunction setValue(m, el) {\n  m.html && setPropertyValue(el, 'html', m.html);\n  m.classes && setPropertyValue(el, 'class', m.classes);\n  m.position && setPropertyValue(el, 'position', m.position);\n  Object.keys(m.attributes).forEach(function (attr) {\n    setPropertyValue(el, attr, m.attributes[attr]);\n  });\n}\n\nfunction setValues() {\n  raf = false;\n  elements.forEach(setValue);\n}\n\nfunction queueDOMUpdates() {\n  if (!raf) {\n    raf = true;\n    requestAnimationFrame(setValues);\n  }\n} // find or create ElementPropertyRecord, add mutation to it, then run\n\n\nfunction startMutating(mutation, element) {\n  var record = null;\n\n  if (mutation.kind === 'html') {\n    record = getElementHTMLRecord(element);\n  } else if (mutation.kind === 'class') {\n    record = getElementClassRecord(element);\n  } else if (mutation.kind === 'attribute') {\n    record = getElementAttributeRecord(element, mutation.attribute);\n  } else if (mutation.kind === 'position') {\n    record = getElementPositionRecord(element);\n  }\n\n  if (!record) return;\n  record.mutations.push(mutation);\n  record.mutationRunner(record);\n} // get (existing) ElementPropertyRecord, remove mutation from it, then run\n\n\nfunction stopMutating(mutation, el) {\n  var record = null;\n\n  if (mutation.kind === 'html') {\n    record = getElementHTMLRecord(el);\n  } else if (mutation.kind === 'class') {\n    record = getElementClassRecord(el);\n  } else if (mutation.kind === 'attribute') {\n    record = getElementAttributeRecord(el, mutation.attribute);\n  } else if (mutation.kind === 'position') {\n    record = getElementPositionRecord(el);\n  }\n\n  if (!record) return;\n  var index = record.mutations.indexOf(mutation);\n  if (index !== -1) record.mutations.splice(index, 1);\n  record.mutationRunner(record);\n} // maintain list of elements associated with mutation\n\n\nfunction refreshElementsSet(mutation) {\n  var existingElements = new Set(mutation.elements);\n  var newElements = new Set();\n  var matchingElements = document.querySelectorAll(mutation.selector);\n  matchingElements.forEach(function (el) {\n    newElements.add(el);\n\n    if (!existingElements.has(el)) {\n      mutation.elements.add(el);\n      startMutating(mutation, el);\n    }\n  });\n  existingElements.forEach(function (el) {\n    if (!newElements.has(el)) {\n      mutation.elements[\"delete\"](el);\n      stopMutating(mutation, el);\n    }\n  });\n}\n\nfunction revertMutation(mutation) {\n  mutation.elements.forEach(function (el) {\n    return stopMutating(mutation, el);\n  });\n  mutation.elements.clear();\n  mutations[\"delete\"](mutation);\n}\n\nfunction refreshAllElementSets() {\n  mutations.forEach(refreshElementsSet);\n} // Observer for elements that don't exist in the DOM yet\n\n\nvar observer;\nfunction disconnectGlobalObserver() {\n  observer && observer.disconnect();\n}\nfunction connectGlobalObserver() {\n  if (typeof document === 'undefined') return;\n\n  if (!observer) {\n    observer = new MutationObserver(function () {\n      refreshAllElementSets();\n    });\n  }\n\n  refreshAllElementSets();\n  observer.observe(document.documentElement, {\n    childList: true,\n    subtree: true,\n    attributes: false,\n    characterData: false\n  });\n} // run on init\n\nconnectGlobalObserver();\n\nfunction newMutation(m) {\n  // Not in a browser\n  if (typeof document === 'undefined') return nullController; // add to global index of mutations\n\n  mutations.add(m); // run refresh on init to establish list of elements associated w/ mutation\n\n  refreshElementsSet(m);\n  return {\n    revert: function revert() {\n      revertMutation(m);\n    }\n  };\n}\n\nfunction html(selector, mutate) {\n  return newMutation({\n    kind: 'html',\n    elements: new Set(),\n    mutate: mutate,\n    selector: selector\n  });\n}\n\nfunction position(selector, mutate) {\n  return newMutation({\n    kind: 'position',\n    elements: new Set(),\n    mutate: mutate,\n    selector: selector\n  });\n}\n\nfunction classes(selector, mutate) {\n  return newMutation({\n    kind: 'class',\n    elements: new Set(),\n    mutate: mutate,\n    selector: selector\n  });\n}\n\nfunction attribute(selector, attribute, mutate) {\n  if (!validAttributeName.test(attribute)) return nullController;\n\n  if (attribute === 'class' || attribute === 'className') {\n    return classes(selector, function (classnames) {\n      var mutatedClassnames = mutate(Array.from(classnames).join(' '));\n      classnames.clear();\n      if (!mutatedClassnames) return;\n      mutatedClassnames.split(/\\s+/g).filter(Boolean).forEach(function (c) {\n        return classnames.add(c);\n      });\n    });\n  }\n\n  return newMutation({\n    kind: 'attribute',\n    attribute: attribute,\n    elements: new Set(),\n    mutate: mutate,\n    selector: selector\n  });\n}\n\nfunction declarative(_ref2) {\n  var selector = _ref2.selector,\n      action = _ref2.action,\n      value = _ref2.value,\n      attr = _ref2.attribute,\n      parentSelector = _ref2.parentSelector,\n      insertBeforeSelector = _ref2.insertBeforeSelector;\n\n  if (attr === 'html') {\n    if (action === 'append') {\n      return html(selector, function (val) {\n        return val + (value != null ? value : '');\n      });\n    } else if (action === 'set') {\n      return html(selector, function () {\n        return value != null ? value : '';\n      });\n    }\n  } else if (attr === 'class') {\n    if (action === 'append') {\n      return classes(selector, function (val) {\n        if (value) val.add(value);\n      });\n    } else if (action === 'remove') {\n      return classes(selector, function (val) {\n        if (value) val[\"delete\"](value);\n      });\n    } else if (action === 'set') {\n      return classes(selector, function (val) {\n        val.clear();\n        if (value) val.add(value);\n      });\n    }\n  } else if (attr === 'position') {\n    if (action === 'set' && parentSelector) {\n      return position(selector, function () {\n        return {\n          insertBeforeSelector: insertBeforeSelector,\n          parentSelector: parentSelector\n        };\n      });\n    }\n  } else {\n    if (action === 'append') {\n      return attribute(selector, attr, function (val) {\n        return val !== null ? val + (value != null ? value : '') : value != null ? value : '';\n      });\n    } else if (action === 'set') {\n      return attribute(selector, attr, function () {\n        return value != null ? value : '';\n      });\n    } else if (action === 'remove') {\n      return attribute(selector, attr, function () {\n        return null;\n      });\n    }\n  }\n\n  return nullController;\n}\n\nvar index = {\n  html: html,\n  classes: classes,\n  attribute: attribute,\n  position: position,\n  declarative: declarative\n};\n\nexport default index;\nexport { connectGlobalObserver, disconnectGlobalObserver, validAttributeName };\n//# sourceMappingURL=dom-mutator.esm.js.map\n","import { UrlTarget, UrlTargetType, VariationRange } from \"./types/growthbook\";\n\nfunction hashFnv32a(str: string): number {\n  let hval = 0x811c9dc5;\n  const l = str.length;\n\n  for (let i = 0; i < l; i++) {\n    hval ^= str.charCodeAt(i);\n    hval +=\n      (hval << 1) + (hval << 4) + (hval << 7) + (hval << 8) + (hval << 24);\n  }\n  return hval >>> 0;\n}\n\nexport function hash(\n  seed: string,\n  value: string,\n  version: number\n): number | null {\n  // New unbiased hashing algorithm\n  if (version === 2) {\n    return (hashFnv32a(hashFnv32a(seed + value) + \"\") % 10000) / 10000;\n  }\n  // Original biased hashing algorithm (keep for backwards compatibility)\n  if (version === 1) {\n    return (hashFnv32a(value + seed) % 1000) / 1000;\n  }\n\n  // Unknown hash version\n  return null;\n}\n\nexport function getEqualWeights(n: number): number[] {\n  if (n <= 0) return [];\n  return new Array(n).fill(1 / n);\n}\n\nexport function inRange(n: number, range: VariationRange): boolean {\n  return n >= range[0] && n < range[1];\n}\n\nexport function inNamespace(\n  hashValue: string,\n  namespace: [string, number, number]\n): boolean {\n  const n = hash(\"__\" + namespace[0], hashValue, 1);\n  if (n === null) return false;\n  return n >= namespace[1] && n < namespace[2];\n}\n\nexport function chooseVariation(n: number, ranges: VariationRange[]): number {\n  for (let i = 0; i < ranges.length; i++) {\n    if (inRange(n, ranges[i])) {\n      return i;\n    }\n  }\n  return -1;\n}\n\nexport function getUrlRegExp(regexString: string): RegExp | undefined {\n  try {\n    const escaped = regexString.replace(/([^\\\\])\\//g, \"$1\\\\/\");\n    return new RegExp(escaped);\n  } catch (e) {\n    console.error(e);\n    return undefined;\n  }\n}\n\nexport function isURLTargeted(url: string, targets: UrlTarget[]) {\n  if (!targets.length) return false;\n  let hasIncludeRules = false;\n  let isIncluded = false;\n\n  for (let i = 0; i < targets.length; i++) {\n    const match = _evalURLTarget(url, targets[i].type, targets[i].pattern);\n    if (targets[i].include === false) {\n      if (match) return false;\n    } else {\n      hasIncludeRules = true;\n      if (match) isIncluded = true;\n    }\n  }\n\n  return isIncluded || !hasIncludeRules;\n}\n\nfunction _evalSimpleUrlPart(\n  actual: string,\n  pattern: string,\n  isPath: boolean\n): boolean {\n  try {\n    // Escape special regex characters and change wildcard `_____` to `.*`\n    let escaped = pattern\n      .replace(/[*.+?^${}()|[\\]\\\\]/g, \"\\\\$&\")\n      .replace(/_____/g, \".*\");\n\n    if (isPath) {\n      // When matching pathname, make leading/trailing slashes optional\n      escaped = \"\\\\/?\" + escaped.replace(/(^\\/|\\/$)/g, \"\") + \"\\\\/?\";\n    }\n\n    const regex = new RegExp(\"^\" + escaped + \"$\", \"i\");\n    return regex.test(actual);\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _evalSimpleUrlTarget(actual: URL, pattern: string) {\n  try {\n    // If a protocol is missing, but a host is specified, add `https://` to the front\n    // Use \"_____\" as the wildcard since `*` is not a valid hostname in some browsers\n    const expected = new URL(\n      pattern.replace(/^([^:/?]*)\\./i, \"https://$1.\").replace(/\\*/g, \"_____\"),\n      \"https://_____\"\n    );\n\n    // Compare each part of the URL separately\n    const comps: Array<[string, string, boolean]> = [\n      [actual.host, expected.host, false],\n      [actual.pathname, expected.pathname, true],\n    ];\n    // We only want to compare hashes if it's explicitly being targeted\n    if (expected.hash) {\n      comps.push([actual.hash, expected.hash, false]);\n    }\n\n    expected.searchParams.forEach((v, k) => {\n      comps.push([actual.searchParams.get(k) || \"\", v, false]);\n    });\n\n    // If any comparisons fail, the whole thing fails\n    return !comps.some(\n      (data) => !_evalSimpleUrlPart(data[0], data[1], data[2])\n    );\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _evalURLTarget(\n  url: string,\n  type: UrlTargetType,\n  pattern: string\n): boolean {\n  try {\n    const parsed = new URL(url, \"https://_\");\n\n    if (type === \"regex\") {\n      const regex = getUrlRegExp(pattern);\n      if (!regex) return false;\n      return (\n        regex.test(parsed.href) ||\n        regex.test(parsed.href.substring(parsed.origin.length))\n      );\n    } else if (type === \"simple\") {\n      return _evalSimpleUrlTarget(parsed, pattern);\n    }\n\n    return false;\n  } catch (e) {\n    return false;\n  }\n}\n\nexport function getBucketRanges(\n  numVariations: number,\n  coverage: number | undefined,\n  weights?: number[]\n): VariationRange[] {\n  coverage = coverage === undefined ? 1 : coverage;\n\n  // Make sure coverage is within bounds\n  if (coverage < 0) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\"Experiment.coverage must be greater than or equal to 0\");\n    }\n    coverage = 0;\n  } else if (coverage > 1) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\"Experiment.coverage must be less than or equal to 1\");\n    }\n    coverage = 1;\n  }\n\n  // Default to equal weights if missing or invalid\n  const equal = getEqualWeights(numVariations);\n  weights = weights || equal;\n  if (weights.length !== numVariations) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\n        \"Experiment.weights array must be the same length as Experiment.variations\"\n      );\n    }\n    weights = equal;\n  }\n\n  // If weights don't add up to 1 (or close to it), default to equal weights\n  const totalWeight = weights.reduce((w, sum) => sum + w, 0);\n  if (totalWeight < 0.99 || totalWeight > 1.01) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\"Experiment.weights must add up to 1\");\n    }\n    weights = equal;\n  }\n\n  // Covert weights to ranges\n  let cumulative = 0;\n  return weights.map((w) => {\n    const start = cumulative;\n    cumulative += w;\n    return [start, start + (coverage as number) * w];\n  }) as VariationRange[];\n}\n\nexport function getQueryStringOverride(\n  id: string,\n  url: string,\n  numVariations: number\n) {\n  if (!url) {\n    return null;\n  }\n\n  const search = url.split(\"?\")[1];\n  if (!search) {\n    return null;\n  }\n\n  const match = search\n    .replace(/#.*/, \"\") // Get rid of anchor\n    .split(\"&\") // Split into key/value pairs\n    .map((kv) => kv.split(\"=\", 2))\n    .filter(([k]) => k === id) // Look for key that matches the experiment id\n    .map(([, v]) => parseInt(v)); // Parse the value into an integer\n\n  if (match.length > 0 && match[0] >= 0 && match[0] < numVariations)\n    return match[0];\n\n  return null;\n}\n\nexport function isIncluded(include: () => boolean) {\n  try {\n    return include();\n  } catch (e) {\n    console.error(e);\n    return false;\n  }\n}\n\nconst base64ToBuf = (b: string) =>\n  Uint8Array.from(atob(b), (c) => c.charCodeAt(0));\n\nexport async function decrypt(\n  encryptedString: string,\n  decryptionKey?: string,\n  subtle?: SubtleCrypto\n): Promise<string> {\n  decryptionKey = decryptionKey || \"\";\n  subtle = subtle || (globalThis.crypto && globalThis.crypto.subtle);\n  if (!subtle) {\n    throw new Error(\"No SubtleCrypto implementation found\");\n  }\n  try {\n    const key = await subtle.importKey(\n      \"raw\",\n      base64ToBuf(decryptionKey),\n      { name: \"AES-CBC\", length: 128 },\n      true,\n      [\"encrypt\", \"decrypt\"]\n    );\n    const [iv, cipherText] = encryptedString.split(\".\");\n    const plainTextBuffer = await subtle.decrypt(\n      { name: \"AES-CBC\", iv: base64ToBuf(iv) },\n      key,\n      base64ToBuf(cipherText)\n    );\n\n    return new TextDecoder().decode(plainTextBuffer);\n  } catch (e) {\n    throw new Error(\"Failed to decrypt\");\n  }\n}\n\nexport function paddedVersionString(input: string): string {\n  // Remove build info and leading `v` if any\n  // Split version into parts (both core version numbers and pre-release tags)\n  // \"v1.2.3-rc.1+build123\" -> [\"1\",\"2\",\"3\",\"rc\",\"1\"]\n  const parts = input.replace(/(^v|\\+.*$)/g, \"\").split(/[-.]/);\n\n  // If it's SemVer without a pre-release, add `~` to the end\n  // [\"1\",\"0\",\"0\"] -> [\"1\",\"0\",\"0\",\"~\"]\n  // \"~\" is the largest ASCII character, so this will make \"1.0.0\" greater than \"1.0.0-beta\" for example\n  if (parts.length === 3) {\n    parts.push(\"~\");\n  }\n\n  // Left pad each numeric part with spaces so string comparisons will work (\"9\">\"10\", but \" 9\"<\"10\")\n  // Then, join back together into a single string\n  return parts\n    .map((v) => (v.match(/^[0-9]+$/) ? v.padStart(5, \" \") : v))\n    .join(\"-\");\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\n\nimport {\n  ConditionInterface,\n  TestedObj,\n  ConditionValue,\n  Operator,\n  OperatorConditionValue,\n  VarType,\n} from \"./types/mongrule\";\nimport { paddedVersionString } from \"./util\";\n\nconst _regexCache: { [key: string]: RegExp } = {};\n\n// The top-level condition evaluation function\nexport function evalCondition(\n  obj: TestedObj,\n  condition: ConditionInterface\n): boolean {\n  // Recursive condition\n  if (\"$or\" in condition) {\n    return evalOr(obj, condition[\"$or\"] as ConditionInterface[]);\n  }\n  if (\"$nor\" in condition) {\n    return !evalOr(obj, condition[\"$nor\"] as ConditionInterface[]);\n  }\n  if (\"$and\" in condition) {\n    return evalAnd(obj, condition[\"$and\"] as ConditionInterface[]);\n  }\n  if (\"$not\" in condition) {\n    return !evalCondition(obj, condition[\"$not\"] as ConditionInterface);\n  }\n\n  // Condition is an object, keys are object paths, values are the condition for that path\n  for (const [k, v] of Object.entries(condition)) {\n    if (!evalConditionValue(v, getPath(obj, k))) return false;\n  }\n  return true;\n}\n\n// Return value at dot-separated path of an object\nfunction getPath(obj: TestedObj, path: string) {\n  const parts = path.split(\".\");\n  let current: any = obj;\n  for (let i = 0; i < parts.length; i++) {\n    if (current && typeof current === \"object\" && parts[i] in current) {\n      current = current[parts[i]];\n    } else {\n      return null;\n    }\n  }\n  return current;\n}\n\n// Transform a regex string into a real RegExp object\nfunction getRegex(regex: string): RegExp {\n  if (!_regexCache[regex]) {\n    _regexCache[regex] = new RegExp(regex.replace(/([^\\\\])\\//g, \"$1\\\\/\"));\n  }\n  return _regexCache[regex];\n}\n\n// Evaluate a single value against a condition\nfunction evalConditionValue(condition: ConditionValue, value: any) {\n  // Simple equality comparisons\n  if (typeof condition === \"string\") {\n    return value + \"\" === condition;\n  }\n  if (typeof condition === \"number\") {\n    return value * 1 === condition;\n  }\n  if (typeof condition === \"boolean\") {\n    return !!value === condition;\n  }\n\n  if (condition === null) {\n    return value === null;\n  }\n\n  if (Array.isArray(condition) || !isOperatorObject(condition)) {\n    return JSON.stringify(value) === JSON.stringify(condition);\n  }\n\n  // This is a special operator condition and we should evaluate each one separately\n  for (const op in condition) {\n    if (\n      !evalOperatorCondition(\n        op as Operator,\n        value,\n        condition[op as keyof OperatorConditionValue]\n      )\n    ) {\n      return false;\n    }\n  }\n  return true;\n}\n\n// If the object has only keys that start with '$'\nfunction isOperatorObject(obj: any): boolean {\n  const keys = Object.keys(obj);\n  return (\n    keys.length > 0 && keys.filter((k) => k[0] === \"$\").length === keys.length\n  );\n}\n\n// Return the data type of a value\nfunction getType(v: any): VarType | \"unknown\" {\n  if (v === null) return \"null\";\n  if (Array.isArray(v)) return \"array\";\n  const t = typeof v;\n  if ([\"string\", \"number\", \"boolean\", \"object\", \"undefined\"].includes(t)) {\n    return t as VarType;\n  }\n  return \"unknown\";\n}\n\n// At least one element of actual must match the expected condition/value\nfunction elemMatch(actual: any, expected: any) {\n  if (!Array.isArray(actual)) return false;\n  const check = isOperatorObject(expected)\n    ? (v: any) => evalConditionValue(expected, v)\n    : (v: any) => evalCondition(v, expected);\n  for (let i = 0; i < actual.length; i++) {\n    if (actual[i] && check(actual[i])) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction isIn(actual: any, expected: Array<any>): boolean {\n  // Do an intersection is attribute is an array\n  if (Array.isArray(actual)) {\n    return actual.some((el) => expected.includes(el));\n  }\n  return expected.includes(actual);\n}\n\n// Evaluate a single operator condition\nfunction evalOperatorCondition(\n  operator: Operator,\n  actual: any,\n  expected: any\n): boolean {\n  switch (operator) {\n    case \"$veq\":\n      return paddedVersionString(actual) === paddedVersionString(expected);\n    case \"$vne\":\n      return paddedVersionString(actual) !== paddedVersionString(expected);\n    case \"$vgt\":\n      return paddedVersionString(actual) > paddedVersionString(expected);\n    case \"$vgte\":\n      return paddedVersionString(actual) >= paddedVersionString(expected);\n    case \"$vlt\":\n      return paddedVersionString(actual) < paddedVersionString(expected);\n    case \"$vlte\":\n      return paddedVersionString(actual) <= paddedVersionString(expected);\n    case \"$eq\":\n      return actual === expected;\n    case \"$ne\":\n      return actual !== expected;\n    case \"$lt\":\n      return actual < expected;\n    case \"$lte\":\n      return actual <= expected;\n    case \"$gt\":\n      return actual > expected;\n    case \"$gte\":\n      return actual >= expected;\n    case \"$exists\":\n      return expected ? actual !== null : actual === null;\n    case \"$in\":\n      if (!Array.isArray(expected)) return false;\n      return isIn(actual, expected);\n    case \"$nin\":\n      if (!Array.isArray(expected)) return false;\n      return !isIn(actual, expected);\n    case \"$not\":\n      return !evalConditionValue(expected, actual);\n    case \"$size\":\n      if (!Array.isArray(actual)) return false;\n      return evalConditionValue(expected, actual.length);\n    case \"$elemMatch\":\n      return elemMatch(actual, expected);\n    case \"$all\":\n      if (!Array.isArray(actual)) return false;\n      for (let i = 0; i < expected.length; i++) {\n        let passed = false;\n        for (let j = 0; j < actual.length; j++) {\n          if (evalConditionValue(expected[i], actual[j])) {\n            passed = true;\n            break;\n          }\n        }\n        if (!passed) return false;\n      }\n      return true;\n    case \"$regex\":\n      try {\n        return getRegex(expected).test(actual);\n      } catch (e) {\n        return false;\n      }\n    case \"$type\":\n      return getType(actual) === expected;\n    default:\n      console.error(\"Unknown operator: \" + operator);\n      return false;\n  }\n}\n\n// Recursive $or rule\nfunction evalOr(obj: TestedObj, conditions: ConditionInterface[]): boolean {\n  if (!conditions.length) return true;\n  for (let i = 0; i < conditions.length; i++) {\n    if (evalCondition(obj, conditions[i])) {\n      return true;\n    }\n  }\n  return false;\n}\n\n// Recursive $and rule\nfunction evalAnd(obj: TestedObj, conditions: ConditionInterface[]): boolean {\n  for (let i = 0; i < conditions.length; i++) {\n    if (!evalCondition(obj, conditions[i])) {\n      return false;\n    }\n  }\n  return true;\n}\n","import mutate, { DeclarativeMutation } from \"dom-mutator\";\nimport type {\n  Context,\n  Experiment,\n  FeatureResult,\n  Result,\n  SubscriptionFunction,\n  FeatureDefinition,\n  FeatureResultSource,\n  Attributes,\n  WidenPrimitives,\n  RealtimeUsageData,\n  LoadFeaturesOptions,\n  RefreshFeaturesOptions,\n  ApiHost,\n  ClientKey,\n  VariationMeta,\n  Filter,\n  VariationRange,\n  AutoExperimentVariation,\n  AutoExperiment,\n} from \"./types/growthbook\";\nimport type { ConditionInterface } from \"./types/mongrule\";\nimport {\n  getUrlRegExp,\n  isIncluded,\n  getBucketRanges,\n  hash,\n  chooseVariation,\n  getQueryStringOverride,\n  inNamespace,\n  inRange,\n  isURLTargeted,\n  decrypt,\n} from \"./util\";\nimport { evalCondition } from \"./mongrule\";\nimport { refreshFeatures, subscribe, unsubscribe } from \"./feature-repository\";\n\nconst isBrowser =\n  typeof window !== \"undefined\" && typeof document !== \"undefined\";\n\nexport class GrowthBook<\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  AppFeatures extends Record<string, any> = Record<string, any>\n> {\n  // context is technically private, but some tools depend on it so we can't mangle the name\n  // _ctx below is a clone of this property that we use internally\n  private context: Context;\n  public debug: boolean;\n  public ready: boolean;\n\n  // Properties and methods that start with \"_\" are mangled by Terser (saves ~150 bytes)\n  private _ctx: Context;\n  private _renderer: null | (() => void);\n  private _trackedExperiments: Set<unknown>;\n  private _trackedFeatures: Record<string, string>;\n  private _subscriptions: Set<SubscriptionFunction>;\n  private _rtQueue: RealtimeUsageData[];\n  private _rtTimer: number;\n  private _assigned: Map<\n    string,\n    {\n      // eslint-disable-next-line\n      experiment: Experiment<any>;\n      // eslint-disable-next-line\n      result: Result<any>;\n    }\n  >;\n  // eslint-disable-next-line\n  private _forcedFeatureValues: Map<string, any>;\n  private _attributeOverrides: Attributes;\n  private _activeAutoExperiments: Map<\n    string,\n    { valueHash: string; undo: () => void }\n  >;\n\n  constructor(context?: Context) {\n    context = context || {};\n    // These properties are all initialized in the constructor instead of above\n    // This saves ~80 bytes in the final output\n    this._ctx = this.context = context;\n    this._renderer = null;\n    this._trackedExperiments = new Set();\n    this._trackedFeatures = {};\n    this.debug = false;\n    this._subscriptions = new Set();\n    this._rtQueue = [];\n    this._rtTimer = 0;\n    this.ready = false;\n    this._assigned = new Map();\n    this._forcedFeatureValues = new Map();\n    this._attributeOverrides = {};\n    this._activeAutoExperiments = new Map();\n\n    if (context.features) {\n      this.ready = true;\n    }\n\n    if (isBrowser && context.enableDevMode) {\n      window._growthbook = this;\n      document.dispatchEvent(new Event(\"gbloaded\"));\n    }\n\n    if (context.experiments) {\n      this.ready = true;\n      this._updateAllAutoExperiments();\n    }\n\n    if (context.clientKey) {\n      this._refresh({}, true, false);\n    }\n  }\n\n  public async loadFeatures(options?: LoadFeaturesOptions): Promise<void> {\n    await this._refresh(options, true, true);\n    if (options && options.autoRefresh) {\n      subscribe(this);\n    }\n  }\n\n  public async refreshFeatures(\n    options?: RefreshFeaturesOptions\n  ): Promise<void> {\n    await this._refresh(options, false, true);\n  }\n\n  public getApiInfo(): [ApiHost, ClientKey] {\n    return [\n      (this._ctx.apiHost || \"https://cdn.growthbook.io\").replace(/\\/*$/, \"\"),\n      this._ctx.clientKey || \"\",\n    ];\n  }\n\n  private async _refresh(\n    options?: RefreshFeaturesOptions,\n    allowStale?: boolean,\n    updateInstance?: boolean\n  ) {\n    options = options || {};\n    if (!this._ctx.clientKey) {\n      throw new Error(\"Missing clientKey\");\n    }\n    await refreshFeatures(\n      this,\n      options.timeout,\n      options.skipCache || this._ctx.enableDevMode,\n      allowStale,\n      updateInstance\n    );\n  }\n\n  private _render() {\n    if (this._renderer) {\n      this._renderer();\n    }\n  }\n\n  public setFeatures(features: Record<string, FeatureDefinition>) {\n    this._ctx.features = features;\n    this.ready = true;\n    this._render();\n  }\n\n  public async setEncryptedFeatures(\n    encryptedString: string,\n    decryptionKey?: string,\n    subtle?: SubtleCrypto\n  ): Promise<void> {\n    const featuresJSON = await decrypt(\n      encryptedString,\n      decryptionKey || this._ctx.decryptionKey,\n      subtle\n    );\n    this.setFeatures(\n      JSON.parse(featuresJSON) as Record<string, FeatureDefinition>\n    );\n  }\n\n  public setExperiments(experiments: AutoExperiment[]): void {\n    this._ctx.experiments = experiments;\n    this.ready = true;\n    this._updateAllAutoExperiments();\n  }\n\n  public async setEncryptedExperiments(\n    encryptedString: string,\n    decryptionKey?: string,\n    subtle?: SubtleCrypto\n  ): Promise<void> {\n    const experimentsJSON = await decrypt(\n      encryptedString,\n      decryptionKey || this._ctx.decryptionKey,\n      subtle\n    );\n    this.setExperiments(JSON.parse(experimentsJSON) as AutoExperiment[]);\n  }\n\n  public setAttributes(attributes: Attributes) {\n    this._ctx.attributes = attributes;\n    this._render();\n    this._updateAllAutoExperiments();\n  }\n\n  public setAttributeOverrides(overrides: Attributes) {\n    this._attributeOverrides = overrides;\n    this._render();\n    this._updateAllAutoExperiments();\n  }\n  public setForcedVariations(vars: Record<string, number>) {\n    this._ctx.forcedVariations = vars || {};\n    this._render();\n    this._updateAllAutoExperiments();\n  }\n  // eslint-disable-next-line\n  public setForcedFeatures(map: Map<string, any>) {\n    this._forcedFeatureValues = map;\n    this._render();\n  }\n\n  public setURL(url: string) {\n    this._ctx.url = url;\n    this._updateAllAutoExperiments(true);\n  }\n\n  public getAttributes() {\n    return { ...this._ctx.attributes, ...this._attributeOverrides };\n  }\n\n  public getFeatures() {\n    return this._ctx.features || {};\n  }\n\n  public getExperiments() {\n    return this._ctx.experiments || [];\n  }\n\n  public subscribe(cb: SubscriptionFunction): () => void {\n    this._subscriptions.add(cb);\n\n    return () => {\n      this._subscriptions.delete(cb);\n    };\n  }\n\n  public getAllResults() {\n    return new Map(this._assigned);\n  }\n\n  public destroy() {\n    // Release references to save memory\n    this._subscriptions.clear();\n    this._assigned.clear();\n    this._trackedExperiments.clear();\n    this._trackedFeatures = {};\n    this._rtQueue = [];\n    if (this._rtTimer) {\n      clearTimeout(this._rtTimer);\n    }\n    unsubscribe(this);\n\n    if (isBrowser && window._growthbook === this) {\n      delete window._growthbook;\n    }\n\n    // Undo any active auto experiments\n    this._activeAutoExperiments.forEach((exp) => {\n      exp.undo();\n    });\n    this._activeAutoExperiments.clear();\n  }\n\n  public setRenderer(renderer: () => void) {\n    this._renderer = renderer;\n  }\n\n  public forceVariation(key: string, variation: number) {\n    this._ctx.forcedVariations = this._ctx.forcedVariations || {};\n    this._ctx.forcedVariations[key] = variation;\n    this._render();\n  }\n\n  public run<T>(experiment: Experiment<T>): Result<T> {\n    const result = this._run(experiment, null);\n    this._fireSubscriptions(experiment, result);\n    return result;\n  }\n\n  public triggerExperiment(key: string) {\n    if (!this._ctx.experiments) return null;\n    const exp = this._ctx.experiments.find((exp) => exp.key === key);\n    if (!exp || !exp.manual) return null;\n    return this._runAutoExperiment(exp, true);\n  }\n\n  private _runAutoExperiment(\n    experiment: AutoExperiment,\n    forceManual?: boolean,\n    forceRerun?: boolean\n  ) {\n    const key = experiment.key;\n    const existing = this._activeAutoExperiments.get(key);\n\n    // If this is a manual experiment and it's not already running, skip\n    if (experiment.manual && !forceManual && !existing) return null;\n\n    // Run the experiment\n    const result = this.run(experiment);\n\n    // A hash to quickly tell if the assigned value changed\n    const valueHash = JSON.stringify(result.value);\n\n    // If the changes are already active, no need to re-apply them\n    if (\n      !forceRerun &&\n      result.inExperiment &&\n      existing &&\n      existing.valueHash === valueHash\n    ) {\n      return result;\n    }\n\n    // Undo any existing changes\n    if (existing) this._undoActiveAutoExperiment(key);\n\n    // Apply new changes\n    if (result.inExperiment) {\n      const undo = this._applyDOMChanges(result.value);\n      if (undo) {\n        this._activeAutoExperiments.set(experiment.key, {\n          undo,\n          valueHash,\n        });\n      }\n    }\n\n    return result;\n  }\n\n  private _undoActiveAutoExperiment(key: string) {\n    const exp = this._activeAutoExperiments.get(key);\n    if (exp) {\n      exp.undo();\n      this._activeAutoExperiments.delete(key);\n    }\n  }\n\n  private _updateAllAutoExperiments(forceRerun?: boolean) {\n    const experiments = this._ctx.experiments || [];\n\n    // Stop any experiments that are no longer defined\n    const keys = new Set(experiments.map((e) => e.key));\n    this._activeAutoExperiments.forEach((v, k) => {\n      if (!keys.has(k)) {\n        v.undo();\n        this._activeAutoExperiments.delete(k);\n      }\n    });\n\n    // Re-run all new/updated experiments\n    experiments.forEach((exp) => {\n      this._runAutoExperiment(exp, false, forceRerun);\n    });\n  }\n\n  private _fireSubscriptions<T>(experiment: Experiment<T>, result: Result<T>) {\n    const key = experiment.key;\n\n    // If assigned variation has changed, fire subscriptions\n    const prev = this._assigned.get(key);\n    // TODO: what if the experiment definition has changed?\n    if (\n      !prev ||\n      prev.result.inExperiment !== result.inExperiment ||\n      prev.result.variationId !== result.variationId\n    ) {\n      this._assigned.set(key, { experiment, result });\n      this._subscriptions.forEach((cb) => {\n        try {\n          cb(experiment, result);\n        } catch (e) {\n          console.error(e);\n        }\n      });\n    }\n  }\n\n  private _trackFeatureUsage(key: string, res: FeatureResult): void {\n    // Don't track feature usage that was forced via an override\n    if (res.source === \"override\") return;\n\n    // Only track a feature once, unless the assigned value changed\n    const stringifiedValue = JSON.stringify(res.value);\n    if (this._trackedFeatures[key] === stringifiedValue) return;\n    this._trackedFeatures[key] = stringifiedValue;\n\n    // Fire user-supplied callback\n    if (this._ctx.onFeatureUsage) {\n      try {\n        this._ctx.onFeatureUsage(key, res);\n      } catch (e) {\n        // Ignore feature usage callback errors\n      }\n    }\n\n    // In browser environments, queue up feature usage to be tracked in batches\n    if (!isBrowser || !window.fetch) return;\n    this._rtQueue.push({\n      key,\n      on: res.on,\n    });\n    if (!this._rtTimer) {\n      this._rtTimer = window.setTimeout(() => {\n        // Reset the queue\n        this._rtTimer = 0;\n        const q = [...this._rtQueue];\n        this._rtQueue = [];\n\n        // Skip logging if a real-time usage key is not configured\n        if (!this._ctx.realtimeKey) return;\n\n        window\n          .fetch(\n            `https://rt.growthbook.io/?key=${\n              this._ctx.realtimeKey\n            }&events=${encodeURIComponent(JSON.stringify(q))}`,\n\n            {\n              cache: \"no-cache\",\n              mode: \"no-cors\",\n            }\n          )\n          .catch(() => {\n            // TODO: retry in case of network errors?\n          });\n      }, this._ctx.realtimeInterval || 2000);\n    }\n  }\n\n  private _getFeatureResult<T>(\n    key: string,\n    value: T,\n    source: FeatureResultSource,\n    ruleId?: string,\n    experiment?: Experiment<T>,\n    result?: Result<T>\n  ): FeatureResult<T> {\n    const ret: FeatureResult = {\n      value,\n      on: !!value,\n      off: !value,\n      source,\n      ruleId: ruleId || \"\",\n    };\n    if (experiment) ret.experiment = experiment;\n    if (result) ret.experimentResult = result;\n\n    // Track the usage of this feature in real-time\n    this._trackFeatureUsage(key, ret);\n\n    return ret;\n  }\n\n  public isOn<K extends string & keyof AppFeatures = string>(key: K): boolean {\n    return this.evalFeature(key).on;\n  }\n\n  public isOff<K extends string & keyof AppFeatures = string>(key: K): boolean {\n    return this.evalFeature(key).off;\n  }\n\n  public getFeatureValue<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(key: K, defaultValue: V): WidenPrimitives<V> {\n    const value = this.evalFeature<WidenPrimitives<V>, K>(key).value;\n    return value === null ? (defaultValue as WidenPrimitives<V>) : value;\n  }\n\n  /**\n   * @deprecated Use {@link evalFeature}\n   * @param id\n   */\n  // eslint-disable-next-line\n  public feature<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(id: K): FeatureResult<V | null> {\n    return this.evalFeature(id);\n  }\n\n  public evalFeature<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(id: K): FeatureResult<V | null> {\n    // Global override\n    if (this._forcedFeatureValues.has(id)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Global override\", {\n          id,\n          value: this._forcedFeatureValues.get(id),\n        });\n      return this._getFeatureResult(\n        id,\n        this._forcedFeatureValues.get(id),\n        \"override\"\n      );\n    }\n\n    // Unknown feature id\n    if (!this._ctx.features || !this._ctx.features[id]) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Unknown feature\", { id });\n      return this._getFeatureResult(id, null, \"unknownFeature\");\n    }\n\n    // Get the feature\n    const feature: FeatureDefinition<V> = this._ctx.features[id];\n\n    // Loop through the rules\n    if (feature.rules) {\n      for (const rule of feature.rules) {\n        // If it's a conditional rule, skip if the condition doesn't pass\n        if (rule.condition && !this._conditionPasses(rule.condition)) {\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Skip rule because of condition\", {\n              id,\n              rule,\n            });\n          continue;\n        }\n        // If there are filters for who is included (e.g. namespaces)\n        if (rule.filters && this._isFilteredOut(rule.filters)) {\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Skip rule because of filters\", {\n              id,\n              rule,\n            });\n          continue;\n        }\n\n        // Feature value is being forced\n        if (\"force\" in rule) {\n          // If this is a percentage rollout, skip if not included\n          if (\n            !this._isIncludedInRollout(\n              rule.seed || id,\n              rule.hashAttribute,\n              rule.range,\n              rule.coverage,\n              rule.hashVersion\n            )\n          ) {\n            process.env.NODE_ENV !== \"production\" &&\n              this.log(\"Skip rule because user not included in rollout\", {\n                id,\n                rule,\n              });\n            continue;\n          }\n\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Force value from rule\", {\n              id,\n              rule,\n            });\n\n          // If this was a remotely evaluated experiment, fire the tracking callbacks\n          if (rule.tracks) {\n            rule.tracks.forEach((t) => {\n              this._track(t.experiment, t.result);\n            });\n          }\n\n          return this._getFeatureResult(id, rule.force as V, \"force\", rule.id);\n        }\n        if (!rule.variations) {\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Skip invalid rule\", {\n              id,\n              rule,\n            });\n\n          continue;\n        }\n        // For experiment rules, run an experiment\n        const exp: Experiment<V> = {\n          variations: rule.variations as [V, V, ...V[]],\n          key: rule.key || id,\n        };\n        if (\"coverage\" in rule) exp.coverage = rule.coverage;\n        if (rule.weights) exp.weights = rule.weights;\n        if (rule.hashAttribute) exp.hashAttribute = rule.hashAttribute;\n        if (rule.namespace) exp.namespace = rule.namespace;\n        if (rule.meta) exp.meta = rule.meta;\n        if (rule.ranges) exp.ranges = rule.ranges;\n        if (rule.name) exp.name = rule.name;\n        if (rule.phase) exp.phase = rule.phase;\n        if (rule.seed) exp.seed = rule.seed;\n        if (rule.hashVersion) exp.hashVersion = rule.hashVersion;\n        if (rule.filters) exp.filters = rule.filters;\n\n        // Only return a value if the user is part of the experiment\n        const res = this._run(exp, id);\n        this._fireSubscriptions(exp, res);\n        if (res.inExperiment && !res.passthrough) {\n          return this._getFeatureResult(\n            id,\n            res.value,\n            \"experiment\",\n            rule.id,\n            exp,\n            res\n          );\n        }\n      }\n    }\n\n    process.env.NODE_ENV !== \"production\" &&\n      this.log(\"Use default value\", {\n        id,\n        value: feature.defaultValue,\n      });\n\n    // Fall back to using the default value\n    return this._getFeatureResult(\n      id,\n      feature.defaultValue === undefined ? null : feature.defaultValue,\n      \"defaultValue\"\n    );\n  }\n\n  private _isIncludedInRollout(\n    seed: string,\n    hashAttribute: string | undefined,\n    range: VariationRange | undefined,\n    coverage: number | undefined,\n    hashVersion: number | undefined\n  ): boolean {\n    if (!range && coverage === undefined) return true;\n\n    const { hashValue } = this._getHashAttribute(hashAttribute);\n    if (!hashValue) {\n      return false;\n    }\n\n    const n = hash(seed, hashValue, hashVersion || 1);\n    if (n === null) return false;\n\n    return range\n      ? inRange(n, range)\n      : coverage !== undefined\n      ? n <= coverage\n      : true;\n  }\n\n  private _conditionPasses(condition: ConditionInterface): boolean {\n    return evalCondition(this.getAttributes(), condition);\n  }\n\n  private _isFilteredOut(filters: Filter[]): boolean {\n    return filters.some((filter) => {\n      const { hashValue } = this._getHashAttribute(filter.attribute);\n      if (!hashValue) return true;\n      const n = hash(filter.seed, hashValue, filter.hashVersion || 2);\n      if (n === null) return true;\n      return !filter.ranges.some((r) => inRange(n, r));\n    });\n  }\n\n  private _run<T>(\n    experiment: Experiment<T>,\n    featureId: string | null\n  ): Result<T> {\n    const key = experiment.key;\n    const numVariations = experiment.variations.length;\n\n    // 1. If experiment has less than 2 variations, return immediately\n    if (numVariations < 2) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Invalid experiment\", { id: key });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 2. If the context is disabled, return immediately\n    if (this._ctx.enabled === false) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Context disabled\", { id: key });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 2.5. Merge in experiment overrides from the context\n    experiment = this._mergeOverrides(experiment);\n\n    // 3. If a variation is forced from a querystring, return the forced variation\n    const qsOverride = getQueryStringOverride(\n      key,\n      this._getContextUrl(),\n      numVariations\n    );\n    if (qsOverride !== null) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Force via querystring\", {\n          id: key,\n          variation: qsOverride,\n        });\n      return this._getResult(experiment, qsOverride, false, featureId);\n    }\n\n    // 4. If a variation is forced in the context, return the forced variation\n    if (this._ctx.forcedVariations && key in this._ctx.forcedVariations) {\n      const variation = this._ctx.forcedVariations[key];\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Force via dev tools\", {\n          id: key,\n          variation,\n        });\n      return this._getResult(experiment, variation, false, featureId);\n    }\n\n    // 5. Exclude if a draft experiment or not active\n    if (experiment.status === \"draft\" || experiment.active === false) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because inactive\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 6. Get the hash attribute and return if empty\n    const { hashValue } = this._getHashAttribute(experiment.hashAttribute);\n    if (!hashValue) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because missing hashAttribute\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 7. Exclude if user is filtered out (used to be called \"namespace\")\n    if (experiment.filters) {\n      if (this._isFilteredOut(experiment.filters)) {\n        process.env.NODE_ENV !== \"production\" &&\n          this.log(\"Skip because of filters\", {\n            id: key,\n          });\n        return this._getResult(experiment, -1, false, featureId);\n      }\n    } else if (\n      experiment.namespace &&\n      !inNamespace(hashValue, experiment.namespace)\n    ) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of namespace\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 7.5. Exclude if experiment.include returns false or throws\n    if (experiment.include && !isIncluded(experiment.include)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of include function\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 8. Exclude if condition is false\n    if (experiment.condition && !this._conditionPasses(experiment.condition)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of condition\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 8.1. Exclude if user is not in a required group\n    if (\n      experiment.groups &&\n      !this._hasGroupOverlap(experiment.groups as string[])\n    ) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of groups\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 8.2. Old style URL targeting\n    if (experiment.url && !this._urlIsValid(experiment.url as RegExp)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of url\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 8.3. New, more powerful URL targeting\n    if (\n      experiment.urlPatterns &&\n      !isURLTargeted(this._getContextUrl(), experiment.urlPatterns)\n    ) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of url targeting\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 9. Get bucket ranges and choose variation\n    const n = hash(\n      experiment.seed || key,\n      hashValue,\n      experiment.hashVersion || 1\n    );\n    if (n === null) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of invalid hash version\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    const ranges =\n      experiment.ranges ||\n      getBucketRanges(\n        numVariations,\n        experiment.coverage === undefined ? 1 : experiment.coverage,\n        experiment.weights\n      );\n\n    const assigned = chooseVariation(n, ranges);\n\n    // 10. Return if not in experiment\n    if (assigned < 0) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of coverage\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 11. Experiment has a forced variation\n    if (\"force\" in experiment) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Force variation\", {\n          id: key,\n          variation: experiment.force,\n        });\n      return this._getResult(\n        experiment,\n        experiment.force === undefined ? -1 : experiment.force,\n        false,\n        featureId\n      );\n    }\n\n    // 12. Exclude if in QA mode\n    if (this._ctx.qaMode) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because QA mode\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 12.5. Exclude if experiment is stopped\n    if (experiment.status === \"stopped\") {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because stopped\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 13. Build the result object\n    const result = this._getResult(experiment, assigned, true, featureId, n);\n\n    // 14. Fire the tracking callback\n    this._track(experiment, result);\n\n    // 15. Return the result\n    process.env.NODE_ENV !== \"production\" &&\n      this.log(\"In experiment\", {\n        id: key,\n        variation: result.variationId,\n      });\n    return result;\n  }\n\n  log(msg: string, ctx: Record<string, unknown>) {\n    if (!this.debug) return;\n    if (this._ctx.log) this._ctx.log(msg, ctx);\n    else console.log(msg, ctx);\n  }\n\n  private _track<T>(experiment: Experiment<T>, result: Result<T>) {\n    if (!this._ctx.trackingCallback) return;\n\n    const key = experiment.key;\n\n    // Make sure a tracking callback is only fired once per unique experiment\n    const k =\n      result.hashAttribute + result.hashValue + key + result.variationId;\n    if (this._trackedExperiments.has(k)) return;\n    this._trackedExperiments.add(k);\n\n    try {\n      this._ctx.trackingCallback(experiment, result);\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  private _mergeOverrides<T>(experiment: Experiment<T>): Experiment<T> {\n    const key = experiment.key;\n    const o = this._ctx.overrides;\n    if (o && o[key]) {\n      experiment = Object.assign({}, experiment, o[key]);\n      if (typeof experiment.url === \"string\") {\n        experiment.url = getUrlRegExp(\n          // eslint-disable-next-line\n          experiment.url as any\n        );\n      }\n    }\n\n    return experiment;\n  }\n\n  private _getHashAttribute(attr?: string) {\n    const hashAttribute = attr || \"id\";\n\n    let hashValue = \"\";\n    if (this._attributeOverrides[hashAttribute]) {\n      hashValue = this._attributeOverrides[hashAttribute];\n    } else if (this._ctx.attributes) {\n      hashValue = this._ctx.attributes[hashAttribute] || \"\";\n    } else if (this._ctx.user) {\n      hashValue = this._ctx.user[hashAttribute] || \"\";\n    }\n\n    return { hashAttribute, hashValue };\n  }\n\n  private _getResult<T>(\n    experiment: Experiment<T>,\n    variationIndex: number,\n    hashUsed: boolean,\n    featureId: string | null,\n    bucket?: number\n  ): Result<T> {\n    let inExperiment = true;\n    // If assigned variation is not valid, use the baseline and mark the user as not in the experiment\n    if (variationIndex < 0 || variationIndex >= experiment.variations.length) {\n      variationIndex = 0;\n      inExperiment = false;\n    }\n\n    const { hashAttribute, hashValue } = this._getHashAttribute(\n      experiment.hashAttribute\n    );\n\n    const meta: Partial<VariationMeta> = experiment.meta\n      ? experiment.meta[variationIndex]\n      : {};\n\n    const res: Result<T> = {\n      key: meta.key || \"\" + variationIndex,\n      featureId,\n      inExperiment,\n      hashUsed,\n      variationId: variationIndex,\n      value: experiment.variations[variationIndex],\n      hashAttribute,\n      hashValue,\n    };\n\n    if (meta.name) res.name = meta.name;\n    if (bucket !== undefined) res.bucket = bucket;\n    if (meta.passthrough) res.passthrough = meta.passthrough;\n\n    return res;\n  }\n\n  private _getContextUrl() {\n    return this._ctx.url || (isBrowser ? window.location.href : \"\");\n  }\n\n  private _urlIsValid(urlRegex: RegExp): boolean {\n    const url = this._getContextUrl();\n    if (!url) return false;\n\n    const pathOnly = url.replace(/^https?:\\/\\//, \"\").replace(/^[^/]*\\//, \"/\");\n\n    if (urlRegex.test(url)) return true;\n    if (urlRegex.test(pathOnly)) return true;\n    return false;\n  }\n\n  private _hasGroupOverlap(expGroups: string[]): boolean {\n    const groups = this._ctx.groups || {};\n    for (let i = 0; i < expGroups.length; i++) {\n      if (groups[expGroups[i]]) return true;\n    }\n    return false;\n  }\n\n  private _applyDOMChanges(changes: AutoExperimentVariation) {\n    if (!isBrowser) return;\n    const undo: (() => void)[] = [];\n    if (changes.css) {\n      const s = document.createElement(\"style\");\n      s.innerHTML = changes.css;\n      document.head.appendChild(s);\n      undo.push(() => s.remove());\n    }\n    if (changes.js) {\n      const script = document.createElement(\"script\");\n      script.innerHTML = changes.js;\n      document.body.appendChild(script);\n      undo.push(() => script.remove());\n    }\n    if (changes.domMutations) {\n      changes.domMutations.forEach((mutation) => {\n        undo.push(mutate.declarative(mutation as DeclarativeMutation).revert);\n      });\n    }\n    return () => {\n      undo.forEach((fn) => fn());\n    };\n  }\n}\n"],"names":["cacheSettings","staleTTL","cacheKey","backgroundSync","polyfills","fetch","globalThis","bind","undefined","SubtleCrypto","crypto","subtle","EventSource","localStorage","e","subscribedInstances","Map","cacheInitialized","cache","activeFetches","streams","supportsSSE","Set","setPolyfills","overrides","Object","assign","configureCache","clearAutoRefresh","async","clearCache","clear","updatePersistentCache","setItem","JSON","stringify","Array","from","entries","getKey","instance","apiHost","clientKey","getApiInfo","concat","onNewFeatureData","key","data","version","dateUpdated","staleAt","Date","now","existing","get","set","instances","forEach","refreshInstance","encryptedExperiments","setEncryptedExperiments","setExperiments","experiments","getExperiments","encryptedFeatures","setEncryptedFeatures","setFeatures","features","getFeatures","fetchFeatures","endpoint","promise","then","res","headers","add","json","startAutoRefresh","delete","catch","Promise","resolve","has","channel","src","cb","event","parse","errors","onSSEError","enableChannel","readyState","delay","Math","pow","random","disableChannel","setTimeout","min","onopen","onerror","close","addEventListener","destroyChannel","validAttributeName","nullController","revert","elements","mutations","getElementRecord","element","record","attributes","createElementPropertyRecord","el","attr","getCurrentValue","setValue","mutationRunner","currentValue","isDirty","originalValue","virtualValue","observer","MutationObserver","observe","childList","subtree","characterData","attributeFilter","getObserverInit","queueIfNeeded","val","currentVal","parentNode","insertBeforeNode","queueDOMUpdates","htmlMutationRunner","m","mutate","html","transformContainer","document","createElement","innerHTML","getTransformedHTML","classMutationRunner","split","filter","Boolean","join","attrMutationRunner","positionMutationRunner","newNodes","_ref","parentSelector","insertBeforeSelector","querySelector","_loadDOMNodes","getHTMLValue","setHTMLValue","value","getElementHTMLRecord","elementRecord","getElementPosition","parentElement","nextElementSibling","setElementPosition","insertBefore","getElementPositionRecord","position","setClassValue","className","removeAttribute","getClassValue","getElementClassRecord","classes","getElementAttributeRecord","attrName","_el$getAttribute","getAttribute","setAttribute","setAttrValue","setPropertyValue","length","_element$html","_element$html$observe","disconnect","_element$classes","_element$classes$obse","_element$position","_element$position$obs","_element$attributes","_element$attributes$a","_element$attributes$a2","deleteElementPropertyRecord","raf","keys","setValues","requestAnimationFrame","stopMutating","mutation","kind","attribute","index","indexOf","splice","refreshElementsSet","existingElements","newElements","querySelectorAll","selector","push","startMutating","refreshAllElementSets","newMutation","test","classnames","mutatedClassnames","c","hashFnv32a","str","hval","l","i","charCodeAt","hash","seed","inRange","n","range","getUrlRegExp","regexString","escaped","replace","RegExp","console","error","isURLTargeted","url","targets","hasIncludeRules","isIncluded","match","_evalURLTarget","type","pattern","include","parsed","URL","regex","href","substring","origin","actual","expected","comps","host","pathname","searchParams","v","k","some","isPath","_evalSimpleUrlPart","_evalSimpleUrlTarget","documentElement","base64ToBuf","b","Uint8Array","atob","decrypt","encryptedString","decryptionKey","Error","importKey","name","iv","cipherText","plainTextBuffer","TextDecoder","decode","paddedVersionString","input","parts","map","padStart","_regexCache","evalCondition","obj","condition","evalOr","conditions","evalAnd","evalConditionValue","getPath","path","current","isArray","isOperatorObject","op","evalOperatorCondition","isIn","includes","operator","check","elemMatch","passed","j","t","getType","isBrowser","window","GrowthBook","constructor","context","this","_ctx","_renderer","_trackedExperiments","_trackedFeatures","debug","_subscriptions","_rtQueue","_rtTimer","ready","_assigned","_forcedFeatureValues","_attributeOverrides","_activeAutoExperiments","enableDevMode","_growthbook","dispatchEvent","Event","_updateAllAutoExperiments","_refresh","options","autoRefresh","subs","subscribe","allowStale","updateInstance","timeout","skipCache","getItem","initializeCache","timer","resolved","finish","clearTimeout","promiseTimeout","fetchFeaturesWithCache","refreshFeatures","_render","featuresJSON","experimentsJSON","setAttributes","setAttributeOverrides","setForcedVariations","vars","forcedVariations","setForcedFeatures","setURL","getAttributes","getAllResults","destroy","s","exp","undo","setRenderer","renderer","forceVariation","variation","run","experiment","result","_run","_fireSubscriptions","triggerExperiment","find","manual","_runAutoExperiment","forceManual","forceRerun","valueHash","inExperiment","_undoActiveAutoExperiment","_applyDOMChanges","prev","variationId","_trackFeatureUsage","source","stringifiedValue","onFeatureUsage","on","q","realtimeKey","encodeURIComponent","mode","realtimeInterval","_getFeatureResult","ruleId","ret","off","experimentResult","isOn","evalFeature","isOff","getFeatureValue","defaultValue","feature","id","rules","rule","_conditionPasses","filters","_isFilteredOut","_isIncludedInRollout","hashAttribute","coverage","hashVersion","tracks","_track","force","variations","weights","namespace","meta","ranges","phase","passthrough","hashValue","_getHashAttribute","r","featureId","numVariations","_getResult","enabled","_mergeOverrides","qsOverride","search","kv","_ref2","parseInt","getQueryStringOverride","_getContextUrl","status","active","inNamespace","groups","_hasGroupOverlap","_urlIsValid","urlPatterns","assigned","chooseVariation","equal","fill","totalWeight","reduce","w","sum","cumulative","start","getBucketRanges","qaMode","log","msg","ctx","trackingCallback","o","user","variationIndex","hashUsed","bucket","location","urlRegex","pathOnly","expGroups","changes","css","head","appendChild","remove","js","script","body","domMutations","action","fn"],"mappings":"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"}